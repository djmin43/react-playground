{"version":3,"file":"actions.js","names":["concatUnique","array1","array2","Array","from","Set","concat","assignChangedPages","assign","context","event","pagesToBuild","data","changedPages","pagesToDelete","deletedPages","assignGraphQLRunners","store","program","assertStore","gatsbyNodeGraphQLFunction","createGraphQLRunner","reporter","graphqlRunner","GraphQLRunner","collectStats","graphqlTracing","dataLayerActions"],"sources":["../../../src/state-machines/data-layer/actions.ts"],"sourcesContent":["import { assign, DoneInvokeEvent, ActionFunctionMap } from \"xstate\"\nimport { createGraphQLRunner } from \"../../bootstrap/create-graphql-runner\"\nimport reporter from \"gatsby-cli/lib/reporter\"\nimport { IDataLayerContext } from \"./types\"\nimport { assertStore } from \"../../utils/assert-store\"\nimport { GraphQLRunner } from \"../../query/graphql-runner\"\n\nconst concatUnique = <T>(\n  array1: Array<T> = [],\n  array2: Array<T> = []\n): Array<T> => Array.from(new Set(array1.concat(array2)))\n\nexport const assignChangedPages = assign<\n  IDataLayerContext,\n  DoneInvokeEvent<{\n    changedPages: Array<string>\n    deletedPages: Array<string>\n  }>\n>((context, event) => {\n  return {\n    pagesToBuild: concatUnique(context.pagesToBuild, event.data.changedPages),\n    pagesToDelete: concatUnique(context.pagesToDelete, event.data.deletedPages),\n  }\n})\n\nexport const assignGraphQLRunners = assign<IDataLayerContext>(\n  ({ store, program }) => {\n    assertStore(store)\n    return {\n      gatsbyNodeGraphQLFunction: createGraphQLRunner(store, reporter),\n      graphqlRunner: new GraphQLRunner(store, {\n        collectStats: true,\n        graphqlTracing: program?.graphqlTracing,\n      }),\n    }\n  }\n)\n\nexport const dataLayerActions: ActionFunctionMap<IDataLayerContext, any> = {\n  assignChangedPages,\n  assignGraphQLRunners,\n}\n"],"mappings":";;;;;;;AAAA;;AACA;;AACA;;AAEA;;AACA;;AAEA,MAAMA,YAAY,GAAG,CACnBC,MAAgB,GAAG,EADA,EAEnBC,MAAgB,GAAG,EAFA,KAGNC,KAAK,CAACC,IAAN,CAAW,IAAIC,GAAJ,CAAQJ,MAAM,CAACK,MAAP,CAAcJ,MAAd,CAAR,CAAX,CAHf;;AAKO,MAAMK,kBAAkB,GAAG,IAAAC,cAAA,EAMhC,CAACC,OAAD,EAAUC,KAAV,KAAoB;EACpB,OAAO;IACLC,YAAY,EAAEX,YAAY,CAACS,OAAO,CAACE,YAAT,EAAuBD,KAAK,CAACE,IAAN,CAAWC,YAAlC,CADrB;IAELC,aAAa,EAAEd,YAAY,CAACS,OAAO,CAACK,aAAT,EAAwBJ,KAAK,CAACE,IAAN,CAAWG,YAAnC;EAFtB,CAAP;AAID,CAXiC,CAA3B;;AAaA,MAAMC,oBAAoB,GAAG,IAAAR,cAAA,EAClC,CAAC;EAAES,KAAF;EAASC;AAAT,CAAD,KAAwB;EACtB,IAAAC,wBAAA,EAAYF,KAAZ;EACA,OAAO;IACLG,yBAAyB,EAAE,IAAAC,wCAAA,EAAoBJ,KAApB,EAA2BK,iBAA3B,CADtB;IAELC,aAAa,EAAE,IAAIC,4BAAJ,CAAkBP,KAAlB,EAAyB;MACtCQ,YAAY,EAAE,IADwB;MAEtCC,cAAc,EAAER,OAAF,aAAEA,OAAF,uBAAEA,OAAO,CAAEQ;IAFa,CAAzB;EAFV,CAAP;AAOD,CAViC,CAA7B;;AAaA,MAAMC,gBAA2D,GAAG;EACzEpB,kBADyE;EAEzES;AAFyE,CAApE"}