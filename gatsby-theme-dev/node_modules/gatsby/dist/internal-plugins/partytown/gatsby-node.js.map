{"version":3,"file":"gatsby-node.js","names":["exports","onPreBootstrap","store","program","getState","copyLibFiles","path","join","directory","createPages","actions","createRedirect","config","partytownProxiedURLs","host","encodedURL","encodeURIComponent","fromPath","thirdPartyProxyPath","toPath","statusCode","onCreateDevServer","app","use","partytownProxy"],"sources":["../../../src/internal-plugins/partytown/gatsby-node.ts"],"sourcesContent":["import path from \"path\"\nimport { copyLibFiles } from \"@builder.io/partytown/utils\"\nimport { CreateDevServerArgs } from \"gatsby\"\nimport { thirdPartyProxyPath, partytownProxy } from \"./proxy\"\n\n/**\n * Copy Partytown library files to public.\n * @see {@link https://partytown.builder.io/copy-library-files}\n */\nexports.onPreBootstrap = async ({ store }): Promise<void> => {\n  const { program } = store.getState()\n  await copyLibFiles(path.join(program.directory, `public`, `~partytown`))\n}\n\n/**\n * Implement reverse proxy so scripts can fetch in web workers without CORS errors.\n * @see {@link https://partytown.builder.io/proxying-requests}\n */\nexports.createPages = ({ actions, store }): void => {\n  const { createRedirect } = actions\n\n  const { config = {} } = store.getState()\n  const { partytownProxiedURLs = [] } = config\n\n  for (const host of partytownProxiedURLs) {\n    const encodedURL: string = encodeURIComponent(host)\n\n    createRedirect({\n      fromPath: `${thirdPartyProxyPath}?url=${encodedURL}`,\n      toPath: host,\n      statusCode: 200,\n    })\n  }\n}\n\nexport async function onCreateDevServer({\n  app,\n  store,\n}: CreateDevServerArgs): Promise<void> {\n  const { config } = store.getState()\n  const { partytownProxiedURLs = [] } = config || {}\n\n  app.use(thirdPartyProxyPath, partytownProxy(partytownProxiedURLs))\n}\n"],"mappings":";;;;;;;AAAA;;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACAA,OAAO,CAACC,cAAR,GAAyB,OAAO;EAAEC;AAAF,CAAP,KAAoC;EAC3D,MAAM;IAAEC;EAAF,IAAcD,KAAK,CAACE,QAAN,EAApB;EACA,MAAM,IAAAC,mBAAA,EAAaC,aAAA,CAAKC,IAAL,CAAUJ,OAAO,CAACK,SAAlB,EAA8B,QAA9B,EAAwC,YAAxC,CAAb,CAAN;AACD,CAHD;AAKA;AACA;AACA;AACA;;;AACAR,OAAO,CAACS,WAAR,GAAsB,CAAC;EAAEC,OAAF;EAAWR;AAAX,CAAD,KAA8B;EAClD,MAAM;IAAES;EAAF,IAAqBD,OAA3B;EAEA,MAAM;IAAEE,MAAM,GAAG;EAAX,IAAkBV,KAAK,CAACE,QAAN,EAAxB;EACA,MAAM;IAAES,oBAAoB,GAAG;EAAzB,IAAgCD,MAAtC;;EAEA,KAAK,MAAME,IAAX,IAAmBD,oBAAnB,EAAyC;IACvC,MAAME,UAAkB,GAAGC,kBAAkB,CAACF,IAAD,CAA7C;IAEAH,cAAc,CAAC;MACbM,QAAQ,EAAG,GAAEC,0BAAoB,QAAOH,UAAW,EADtC;MAEbI,MAAM,EAAEL,IAFK;MAGbM,UAAU,EAAE;IAHC,CAAD,CAAd;EAKD;AACF,CAfD;;AAiBO,eAAeC,iBAAf,CAAiC;EACtCC,GADsC;EAEtCpB;AAFsC,CAAjC,EAGgC;EACrC,MAAM;IAAEU;EAAF,IAAaV,KAAK,CAACE,QAAN,EAAnB;EACA,MAAM;IAAES,oBAAoB,GAAG;EAAzB,IAAgCD,MAAM,IAAI,EAAhD;EAEAU,GAAG,CAACC,GAAJ,CAAQL,0BAAR,EAA6B,IAAAM,qBAAA,EAAeX,oBAAf,CAA7B;AACD"}