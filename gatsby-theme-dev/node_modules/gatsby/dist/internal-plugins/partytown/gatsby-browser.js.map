{"version":3,"file":"gatsby-browser.js","names":["PartytownProvider","children","collectedForwards","collectedAnyScript","setState","useState","Set","collectScript","newScript","stateShouldChange","potentialNewState","forward","Array","isArray","singleForward","has","add","process","env","NODE_ENV","console","log","from","wrapRootElement","element"],"sources":["../../../src/internal-plugins/partytown/gatsby-browser.tsx"],"sourcesContent":["import React, { ReactElement, useState } from \"react\"\nimport type { GatsbySSR } from \"gatsby\"\nimport { Partytown } from \"@builder.io/partytown/react\"\nimport { PartytownContext, ScriptProps } from \"gatsby-script\"\n\ninterface ICollectedForwardsState {\n  collectedForwards: Set<string>\n  collectedAnyScript: boolean\n}\n\nfunction PartytownProvider({ children }): ReactElement {\n  const [{ collectedForwards, collectedAnyScript }, setState] =\n    useState<ICollectedForwardsState>({\n      collectedForwards: new Set(),\n      collectedAnyScript: false,\n    })\n\n  return (\n    <PartytownContext.Provider\n      value={{\n        collectScript: (newScript: ScriptProps): void => {\n          let stateShouldChange = false\n          const potentialNewState = {\n            collectedAnyScript,\n            collectedForwards,\n          }\n\n          if (!collectedAnyScript) {\n            potentialNewState.collectedAnyScript = true\n            stateShouldChange = true\n          }\n\n          if (newScript?.forward) {\n            if (Array.isArray(newScript.forward)) {\n              for (const singleForward of newScript.forward) {\n                if (!potentialNewState.collectedForwards.has(singleForward)) {\n                  potentialNewState.collectedForwards.add(singleForward)\n                  stateShouldChange = true\n                }\n              }\n            } else {\n              if (process.env.NODE_ENV === `development`) {\n                console.log(`unexpected shape of forward`, newScript)\n              }\n            }\n          }\n\n          if (stateShouldChange) {\n            setState(potentialNewState)\n          }\n        },\n      }}\n    >\n      {children}\n      {collectedAnyScript && (\n        <Partytown key=\"partytown\" forward={Array.from(collectedForwards)} />\n      )}\n    </PartytownContext.Provider>\n  )\n}\n\nexport const wrapRootElement: GatsbySSR[`wrapRootElement`] = ({ element }) => (\n  <PartytownProvider>{element}</PartytownProvider>\n)\n"],"mappings":";;;;;AAAA;;AAEA;;AACA;;;;;;AAOA,SAASA,iBAAT,CAA2B;EAAEC;AAAF,CAA3B,EAAuD;EACrD,MAAM,CAAC;IAAEC,iBAAF;IAAqBC;EAArB,CAAD,EAA4CC,QAA5C,IACJ,IAAAC,eAAA,EAAkC;IAChCH,iBAAiB,EAAE,IAAII,GAAJ,EADa;IAEhCH,kBAAkB,EAAE;EAFY,CAAlC,CADF;EAMA,oBACE,6BAAC,8BAAD,CAAkB,QAAlB;IACE,KAAK,EAAE;MACLI,aAAa,EAAGC,SAAD,IAAkC;QAC/C,IAAIC,iBAAiB,GAAG,KAAxB;QACA,MAAMC,iBAAiB,GAAG;UACxBP,kBADwB;UAExBD;QAFwB,CAA1B;;QAKA,IAAI,CAACC,kBAAL,EAAyB;UACvBO,iBAAiB,CAACP,kBAAlB,GAAuC,IAAvC;UACAM,iBAAiB,GAAG,IAApB;QACD;;QAED,IAAID,SAAJ,aAAIA,SAAJ,eAAIA,SAAS,CAAEG,OAAf,EAAwB;UACtB,IAAIC,KAAK,CAACC,OAAN,CAAcL,SAAS,CAACG,OAAxB,CAAJ,EAAsC;YACpC,KAAK,MAAMG,aAAX,IAA4BN,SAAS,CAACG,OAAtC,EAA+C;cAC7C,IAAI,CAACD,iBAAiB,CAACR,iBAAlB,CAAoCa,GAApC,CAAwCD,aAAxC,CAAL,EAA6D;gBAC3DJ,iBAAiB,CAACR,iBAAlB,CAAoCc,GAApC,CAAwCF,aAAxC;gBACAL,iBAAiB,GAAG,IAApB;cACD;YACF;UACF,CAPD,MAOO;YACL,IAAIQ,OAAO,CAACC,GAAR,CAAYC,QAAZ,KAA0B,aAA9B,EAA4C;cAC1CC,OAAO,CAACC,GAAR,CAAa,6BAAb,EAA2Cb,SAA3C;YACD;UACF;QACF;;QAED,IAAIC,iBAAJ,EAAuB;UACrBL,QAAQ,CAACM,iBAAD,CAAR;QACD;MACF;IA/BI;EADT,GAmCGT,QAnCH,EAoCGE,kBAAkB,iBACjB,6BAAC,iBAAD;IAAW,GAAG,EAAC,WAAf;IAA2B,OAAO,EAAES,KAAK,CAACU,IAAN,CAAWpB,iBAAX;EAApC,EArCJ,CADF;AA0CD;;AAEM,MAAMqB,eAA6C,GAAG,CAAC;EAAEC;AAAF,CAAD,kBAC3D,6BAAC,iBAAD,QAAoBA,OAApB,CADK"}