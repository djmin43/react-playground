{"version":3,"file":"gatsby-ssr.js","names":["collectedScripts","Map","wrapRootElement","element","pathname","collectScript","newScript","currentCollectedScripts","get","push","set","onRenderBody","setHeadComponents","collectedScriptsOnPage","length","collectedForwards","flatMap","script","forward","delete"],"sources":["../../../src/internal-plugins/partytown/gatsby-ssr.tsx"],"sourcesContent":["import React from \"react\"\nimport type { GatsbySSR } from \"gatsby\"\nimport { Partytown } from \"@builder.io/partytown/react\"\nimport { PartytownContext, ScriptProps } from \"gatsby-script\"\n\nconst collectedScripts: Map<string, Array<ScriptProps>> = new Map()\n\nexport const wrapRootElement: GatsbySSR[`wrapRootElement`] = ({\n  element,\n  pathname,\n}) => (\n  <PartytownContext.Provider\n    value={{\n      collectScript: (newScript: ScriptProps): void => {\n        const currentCollectedScripts = collectedScripts.get(pathname) || []\n        currentCollectedScripts.push(newScript)\n        collectedScripts.set(pathname, currentCollectedScripts)\n      },\n    }}\n  >\n    {element}\n  </PartytownContext.Provider>\n)\n\nexport const onRenderBody: GatsbySSR[`onRenderBody`] = ({\n  pathname,\n  setHeadComponents,\n}) => {\n  const collectedScriptsOnPage = collectedScripts.get(pathname)\n\n  if (!collectedScriptsOnPage?.length) {\n    return\n  }\n\n  const collectedForwards: Array<string> = collectedScriptsOnPage?.flatMap(\n    (script: ScriptProps) => script?.forward || []\n  )\n\n  setHeadComponents([<Partytown key=\"partytown\" forward={collectedForwards} />])\n\n  collectedScripts.delete(pathname)\n}\n"],"mappings":";;;;;;;AAAA;;AAEA;;AACA;;AAEA,MAAMA,gBAAiD,GAAG,IAAIC,GAAJ,EAA1D;;AAEO,MAAMC,eAA6C,GAAG,CAAC;EAC5DC,OAD4D;EAE5DC;AAF4D,CAAD,kBAI3D,6BAAC,8BAAD,CAAkB,QAAlB;EACE,KAAK,EAAE;IACLC,aAAa,EAAGC,SAAD,IAAkC;MAC/C,MAAMC,uBAAuB,GAAGP,gBAAgB,CAACQ,GAAjB,CAAqBJ,QAArB,KAAkC,EAAlE;MACAG,uBAAuB,CAACE,IAAxB,CAA6BH,SAA7B;MACAN,gBAAgB,CAACU,GAAjB,CAAqBN,QAArB,EAA+BG,uBAA/B;IACD;EALI;AADT,GASGJ,OATH,CAJK;;;;AAiBA,MAAMQ,YAAuC,GAAG,CAAC;EACtDP,QADsD;EAEtDQ;AAFsD,CAAD,KAGjD;EACJ,MAAMC,sBAAsB,GAAGb,gBAAgB,CAACQ,GAAjB,CAAqBJ,QAArB,CAA/B;;EAEA,IAAI,EAACS,sBAAD,aAACA,sBAAD,eAACA,sBAAsB,CAAEC,MAAzB,CAAJ,EAAqC;IACnC;EACD;;EAED,MAAMC,iBAAgC,GAAGF,sBAAH,aAAGA,sBAAH,uBAAGA,sBAAsB,CAAEG,OAAxB,CACtCC,MAAD,IAAyB,CAAAA,MAAM,SAAN,IAAAA,MAAM,WAAN,YAAAA,MAAM,CAAEC,OAAR,KAAmB,EADL,CAAzC;EAIAN,iBAAiB,CAAC,cAAC,6BAAC,iBAAD;IAAW,GAAG,EAAC,WAAf;IAA2B,OAAO,EAAEG;EAApC,EAAD,CAAD,CAAjB;EAEAf,gBAAgB,CAACmB,MAAjB,CAAwBf,QAAxB;AACD,CAjBM"}