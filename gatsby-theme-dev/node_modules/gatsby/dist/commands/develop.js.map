{"version":3,"file":"develop.js","names":["requireUncached","file","require","cache","resolve","e","getDebugPort","port","getDebugInfo","program","Object","prototype","hasOwnProperty","call","inspect","break","inspectBrk","ControllableScript","constructor","script","debugInfo","start","args","tmpFileName","tmp","tmpNameSync","tmpdir","path","join","process","cwd","fs","outputFileSync","isRunning","push","execa","node","env","GATSBY_NODE_GLOBALS","JSON","stringify","global","__GATSBY","stdio","stop","signal","code","Error","kill","send","type","action","payload","err","Promise","on","removeAllListeners","undefined","onMessage","callback","onExit","msg","isRestarting","REGEX_IP","module","exports","buildId","v4","root","directory","parseInt","developProcessPath","slash","detectPortInUseAndPrompt","message","exit","rootFile","developPort","https","reporter","panic","sslHost","host","test","ssl","getSslCert","name","caFile","certFile","keyFile","developProcess","proxyPort","handleChildProcessIPC","telemetryFlush","pid","shutdownServices","_code","services","all","catch","then"],"sources":["../../src/commands/develop.ts"],"sourcesContent":["// NOTE(@mxstbr): Do not use the reporter in this file, as that has side-effects on import which break structured logging\nimport path from \"path\"\nimport tmp from \"tmp\"\nimport { ChildProcess } from \"child_process\"\nimport execa from \"execa\"\nimport { detectPortInUseAndPrompt } from \"../utils/detect-port-in-use-and-prompt\"\nimport fs from \"fs-extra\"\nimport onExit from \"signal-exit\"\nimport { v4 } from \"gatsby-core-utils/uuid\"\nimport { slash } from \"gatsby-core-utils/path\"\nimport reporter from \"gatsby-cli/lib/reporter\"\nimport { getSslCert } from \"../utils/get-ssl-cert\"\nimport { IProgram, IDebugInfo } from \"./types\"\nimport { flush as telemetryFlush } from \"gatsby-telemetry\"\n\n// Adapted from https://stackoverflow.com/a/16060619\nconst requireUncached = (file: string): any => {\n  try {\n    delete require.cache[require.resolve(file)]\n  } catch (e) {\n    return null\n  }\n\n  try {\n    return require(file)\n  } catch (e) {\n    return null\n  }\n}\n\n// Return a user-supplied port otherwise the default Node.js debugging port\nconst getDebugPort = (port?: number): number => port ?? 9229\n\nexport const getDebugInfo = (program: IProgram): IDebugInfo | null => {\n  if (Object.prototype.hasOwnProperty.call(program, `inspect`)) {\n    return {\n      port: getDebugPort(program.inspect),\n      break: false,\n    }\n  } else if (Object.prototype.hasOwnProperty.call(program, `inspectBrk`)) {\n    return {\n      port: getDebugPort(program.inspectBrk),\n      break: true,\n    }\n  } else {\n    return null\n  }\n}\n\nclass ControllableScript {\n  private process?: ChildProcess\n  private script\n  private debugInfo: IDebugInfo | null\n  public isRunning\n  constructor(script, debugInfo: IDebugInfo | null) {\n    this.script = script\n    this.debugInfo = debugInfo\n  }\n  start(): void {\n    const args: Array<string> = []\n    const tmpFileName = tmp.tmpNameSync({\n      tmpdir: path.join(process.cwd(), `.cache`),\n    })\n    fs.outputFileSync(tmpFileName, this.script)\n    this.isRunning = true\n    // Passing --inspect isn't necessary for the child process to launch a port but it allows some editors to automatically attach\n    if (this.debugInfo) {\n      if (this.debugInfo.break) {\n        args.push(`--inspect-brk=${this.debugInfo.port}`)\n      } else {\n        args.push(`--inspect=${this.debugInfo.port}`)\n      }\n    }\n\n    this.process = execa.node(tmpFileName, args, {\n      env: {\n        ...process.env,\n        GATSBY_NODE_GLOBALS: JSON.stringify(global.__GATSBY ?? {}),\n      },\n      stdio: [`inherit`, `inherit`, `inherit`, `ipc`],\n    })\n  }\n  async stop(\n    signal: NodeJS.Signals | null = null,\n    code?: number\n  ): Promise<void> {\n    if (!this.process) {\n      throw new Error(`Trying to stop the process before starting it`)\n    }\n\n    this.isRunning = false\n    try {\n      if (signal) {\n        this.process.kill(signal)\n      } else {\n        this.process.send(\n          {\n            type: `COMMAND`,\n            action: {\n              type: `EXIT`,\n              payload: code,\n            },\n          },\n          () => {\n            // The try/catch won't suffice for this process.send\n            // So use the callback to manually catch the Error, otherwise it'll be thrown\n            // Ref: https://nodejs.org/api/child_process.html#child_process_subprocess_send_message_sendhandle_options_callback\n          }\n        )\n      }\n    } catch (err) {\n      // Ignore error if process has crashed or already quit.\n      // Ref: https://github.com/gatsbyjs/gatsby/issues/28011#issuecomment-877302917\n    }\n\n    return new Promise(resolve => {\n      if (!this.process) {\n        throw new Error(`Trying to stop the process before starting it`)\n      }\n\n      this.process.on(`exit`, () => {\n        if (this.process) {\n          this.process.removeAllListeners()\n        }\n        this.process = undefined\n        resolve()\n      })\n    })\n  }\n  onMessage(callback: (msg: any) => void): void {\n    if (!this.process) {\n      throw new Error(`Trying to attach message handler before process started`)\n    }\n    this.process.on(`message`, callback)\n  }\n  onExit(\n    callback: (code: number | null, signal: NodeJS.Signals | null) => void\n  ): void {\n    if (!this.process) {\n      throw new Error(`Trying to attach exit handler before process started`)\n    }\n    this.process.on(`exit`, callback)\n  }\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  send(msg: any): void {\n    if (!this.process) {\n      throw new Error(`Trying to send a message before process started`)\n    }\n\n    this.process.send(msg)\n  }\n}\n\nlet isRestarting\n\n// checks if a string is a valid ip\nconst REGEX_IP =\n  /^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9]?[0-9])\\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9]?[0-9])$/\n\nmodule.exports = async (program: IProgram): Promise<void> => {\n  global.__GATSBY = {\n    buildId: v4(),\n    root: program.directory,\n  }\n\n  // In some cases, port can actually be a string. But our codebase is expecting it to be a number.\n  // So we want to early just force it to a number to ensure we always act on a correct type.\n  program.port = parseInt(program.port + ``, 10)\n  const developProcessPath = slash(require.resolve(`./develop-process`))\n\n  try {\n    program.port = await detectPortInUseAndPrompt(program.port)\n  } catch (e) {\n    if (e.message === `USER_REJECTED`) {\n      process.exit(0)\n    }\n\n    throw e\n  }\n\n  // Run the actual develop server on a random port, and the proxy on the program port\n  // which users will access\n  const debugInfo = getDebugInfo(program)\n\n  const rootFile = (file: string): string => path.join(program.directory, file)\n\n  // Require gatsby-config.js before accessing process.env, to enable the user to change\n  // environment variables from the config file.\n  requireUncached(rootFile(`gatsby-config`))\n\n  const developPort = program.port\n\n  // In order to enable custom ssl, --cert-file --key-file and -https flags must all be\n  // used together\n  if ((program[`cert-file`] || program[`key-file`]) && !program.https) {\n    reporter.panic(\n      `for custom ssl --https, --cert-file, and --key-file must be used together`\n    )\n  }\n\n  // Check if https is enabled, then create or get SSL cert.\n  // Certs are named 'devcert' and issued to the host.\n  // NOTE(@mxstbr): We mutate program.ssl _after_ passing it\n  // to the develop process controllable script above because\n  // that would mean we double SSL browser => proxy => server\n  if (program.https) {\n    const sslHost =\n      program.host === `0.0.0.0` || program.host === `::`\n        ? `localhost`\n        : program.host\n\n    if (REGEX_IP.test(sslHost)) {\n      reporter.panic(\n        `You're trying to generate a ssl certificate for an IP (${sslHost}). Please use a hostname instead.`\n      )\n    }\n\n    const ssl = await getSslCert({\n      name: sslHost,\n      caFile: program[`ca-file`],\n      certFile: program[`cert-file`],\n      keyFile: program[`key-file`],\n      directory: program.directory,\n    })\n\n    if (ssl) {\n      program.ssl = ssl\n    }\n  }\n\n  const developProcess = new ControllableScript(\n    `\n    const cmd = require(${JSON.stringify(developProcessPath)});\n    const args = ${JSON.stringify({\n      ...program,\n      port: developPort,\n      // TODO(v5): remove\n      proxyPort: developPort,\n      debugInfo,\n    })};\n    cmd(args);\n  `,\n    debugInfo\n  )\n\n  const handleChildProcessIPC = (msg): void => {\n    if (msg.type === `HEARTBEAT`) return\n    if (process.send) {\n      // Forward IPC\n      process.send(msg)\n    }\n  }\n\n  developProcess.start()\n  developProcess.onMessage(handleChildProcessIPC)\n\n  // Plugins can call `process.exit` which would be sent to `develop-process` (child process)\n  // This needs to be propagated back to the parent process\n  developProcess.onExit(\n    (code: number | null, signal: NodeJS.Signals | null) => {\n      try {\n        telemetryFlush()\n      } catch (e) {\n        // nop\n      }\n      if (isRestarting) return\n      if (signal !== null) {\n        process.kill(process.pid, signal)\n        return\n      }\n      if (code !== null) {\n        process.exit(code)\n      }\n\n      // This should not happen:\n      // https://nodejs.org/api/child_process.html#child_process_event_exit\n      // The 'exit' event is emitted after the child process ends. If the process\n      // exited, code is the final exit code of the process, otherwise null.\n      // If the process terminated due to receipt of a signal, signal is the\n      // string name of the signal, otherwise null. One of the two will always be\n      // non - null.\n      //\n      // but just in case let do non-zero exit, because we are in situation\n      // we don't expect to be possible\n      process.exit(1)\n    }\n  )\n\n  // route ipc messaging to the original develop process\n  process.on(`message`, msg => {\n    developProcess.send(msg)\n  })\n\n  process.on(`SIGINT`, async () => {\n    await shutdownServices(\n      {\n        developProcess,\n      },\n      `SIGINT`\n    )\n\n    process.exit(0)\n  })\n\n  process.on(`SIGTERM`, async () => {\n    await shutdownServices(\n      {\n        developProcess,\n      },\n      `SIGTERM`\n    )\n\n    process.exit(0)\n  })\n\n  onExit((_code, signal) => {\n    shutdownServices(\n      {\n        developProcess,\n      },\n      signal as NodeJS.Signals\n    )\n  })\n}\n\ninterface IShutdownServicesOptions {\n  developProcess: ControllableScript\n}\n\nfunction shutdownServices(\n  { developProcess }: IShutdownServicesOptions,\n  signal: NodeJS.Signals\n): Promise<void> {\n  try {\n    telemetryFlush()\n  } catch (e) {\n    // nop\n  }\n  const services = [developProcess.stop(signal)]\n\n  return Promise.all(services)\n    .catch(() => {})\n    .then(() => {})\n}\n"],"mappings":"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"}