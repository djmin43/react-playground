{"version":3,"file":"batcher.js","names":["Batcher","queue","callbacks","bulkCallbacks","constructor","threshold","add","args","push","length","flush","forEach","callback","call","bulkCall"],"sources":["../../src/utils/batcher.ts"],"sourcesContent":["export default class Batcher<Callback extends (...args: Array<any>) => any> {\n  private queue: Array<Parameters<Callback>> = []\n  private callbacks: Array<(...args: Parameters<Callback>) => void> = []\n  private bulkCallbacks: Array<(args: Array<Parameters<Callback>>) => void> = []\n\n  constructor(private threshold: number) {}\n\n  /** Add a call to the batcher */\n  add(...args: Parameters<Callback>): void {\n    this.queue.push(args)\n\n    if (this.queue.length >= this.threshold) {\n      this.flush()\n    }\n  }\n\n  /** Call all of our callbacks and clear out the queue */\n  flush(): void {\n    // call each callback for each item in the queue\n    this.queue.forEach(args =>\n      this.callbacks.forEach(callback => callback(...args))\n    )\n\n    // pass the entire queue to all bulk callbacks\n    this.bulkCallbacks.forEach(callback => {\n      callback(this.queue)\n    })\n\n    // clear out the queue\n    this.queue = []\n  }\n\n  /** Sets up a callback for each batcher item */\n  call(callback: (...args: Parameters<Callback>) => void): void {\n    this.callbacks.push(callback)\n  }\n\n  /** Sets up a bulk callback that takes the entire queue */\n  bulkCall(callback: (args: Array<Parameters<Callback>>) => void): void {\n    this.bulkCallbacks.push(callback)\n  }\n}\n"],"mappings":";;;;;AAAe,MAAMA,OAAN,CAA6D;EAClEC,KAAK,GAAgC,EAAhC;EACLC,SAAS,GAAmD,EAAnD;EACTC,aAAa,GAAuD,EAAvD;;EAErBC,WAAW,CAASC,SAAT,EAA4B;IAAA,KAAnBA,SAAmB,GAAnBA,SAAmB;EAAE;EAEzC;;;EACAC,GAAG,CAAC,GAAGC,IAAJ,EAAsC;IACvC,KAAKN,KAAL,CAAWO,IAAX,CAAgBD,IAAhB;;IAEA,IAAI,KAAKN,KAAL,CAAWQ,MAAX,IAAqB,KAAKJ,SAA9B,EAAyC;MACvC,KAAKK,KAAL;IACD;EACF;EAED;;;EACAA,KAAK,GAAS;IACZ;IACA,KAAKT,KAAL,CAAWU,OAAX,CAAmBJ,IAAI,IACrB,KAAKL,SAAL,CAAeS,OAAf,CAAuBC,QAAQ,IAAIA,QAAQ,CAAC,GAAGL,IAAJ,CAA3C,CADF,EAFY,CAMZ;;IACA,KAAKJ,aAAL,CAAmBQ,OAAnB,CAA2BC,QAAQ,IAAI;MACrCA,QAAQ,CAAC,KAAKX,KAAN,CAAR;IACD,CAFD,EAPY,CAWZ;;IACA,KAAKA,KAAL,GAAa,EAAb;EACD;EAED;;;EACAY,IAAI,CAACD,QAAD,EAA0D;IAC5D,KAAKV,SAAL,CAAeM,IAAf,CAAoBI,QAApB;EACD;EAED;;;EACAE,QAAQ,CAACF,QAAD,EAA8D;IACpE,KAAKT,aAAL,CAAmBK,IAAnB,CAAwBI,QAAxB;EACD;;AAxCyE"}