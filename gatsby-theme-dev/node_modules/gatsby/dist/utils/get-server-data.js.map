{"version":3,"file":"get-server-data.js","names":["getServerData","req","page","pagePath","mod","ensuredLeadingSlash","startsWith","params","match","matchPath","path","fsRouteParams","context","getServerDataArg","headers","Map","Object","entries","method","url","query","pageContext"],"sources":["../../src/utils/get-server-data.ts"],"sourcesContent":["import type { Request } from \"express\"\nimport type { IGatsbyPage } from \"../redux/types\"\n\nimport { match } from \"@gatsbyjs/reach-router/lib/utils\"\n\nexport interface IServerData {\n  headers?: Record<string, string>\n  props?: Record<string, unknown>\n  status?: number\n}\n\ninterface IModuleWithServerData {\n  getServerData?: (args: {\n    headers: Map<string, unknown>\n    method: string\n    url: string\n    query?: Record<string, unknown>\n    params?: Record<string, unknown>\n    pageContext: Record<string, unknown>\n  }) => Promise<IServerData>\n}\n\nexport async function getServerData(\n  req:\n    | Partial<Pick<Request, \"query\" | \"method\" | \"url\" | \"headers\">>\n    | undefined,\n  page: IGatsbyPage,\n  pagePath: string,\n  mod: IModuleWithServerData | undefined\n): Promise<IServerData> {\n  if (!mod?.getServerData) {\n    return {}\n  }\n\n  const ensuredLeadingSlash = pagePath.startsWith(`/`)\n    ? pagePath\n    : `/${pagePath}`\n\n  const { params } = match(page.matchPath || page.path, ensuredLeadingSlash)\n  const fsRouteParams =\n    typeof page.context[`__params`] === `object` ? page.context[`__params`] : {}\n\n  const getServerDataArg = {\n    headers: new Map(Object.entries(req?.headers ?? {})),\n    method: req?.method ?? `GET`,\n    url: req?.url ?? `\"req\" most likely wasn't passed in`,\n    query: req?.query ?? {},\n    pageContext: page.context,\n    params: {\n      ...params,\n      ...fsRouteParams,\n    },\n  }\n\n  return mod.getServerData(getServerDataArg)\n}\n"],"mappings":";;;;;AAGA;;AAmBO,eAAeA,aAAf,CACLC,GADK,EAILC,IAJK,EAKLC,QALK,EAMLC,GANK,EAOiB;EAAA;;EACtB,IAAI,EAACA,GAAD,aAACA,GAAD,eAACA,GAAG,CAAEJ,aAAN,CAAJ,EAAyB;IACvB,OAAO,EAAP;EACD;;EAED,MAAMK,mBAAmB,GAAGF,QAAQ,CAACG,UAAT,CAAqB,GAArB,IACxBH,QADwB,GAEvB,IAAGA,QAAS,EAFjB;EAIA,MAAM;IAAEI;EAAF,IAAa,IAAAC,YAAA,EAAMN,IAAI,CAACO,SAAL,IAAkBP,IAAI,CAACQ,IAA7B,EAAmCL,mBAAnC,CAAnB;EACA,MAAMM,aAAa,GACjB,OAAOT,IAAI,CAACU,OAAL,CAAc,UAAd,CAAP,KAAqC,QAArC,GAA+CV,IAAI,CAACU,OAAL,CAAc,UAAd,CAA/C,GAA0E,EAD5E;EAGA,MAAMC,gBAAgB,GAAG;IACvBC,OAAO,EAAE,IAAIC,GAAJ,CAAQC,MAAM,CAACC,OAAP,iBAAehB,GAAf,aAAeA,GAAf,uBAAeA,GAAG,CAAEa,OAApB,uDAA+B,EAA/B,CAAR,CADc;IAEvBI,MAAM,iBAAEjB,GAAF,aAAEA,GAAF,uBAAEA,GAAG,CAAEiB,MAAP,qDAAkB,KAFD;IAGvBC,GAAG,cAAElB,GAAF,aAAEA,GAAF,uBAAEA,GAAG,CAAEkB,GAAP,+CAAe,oCAHK;IAIvBC,KAAK,gBAAEnB,GAAF,aAAEA,GAAF,uBAAEA,GAAG,CAAEmB,KAAP,mDAAgB,EAJE;IAKvBC,WAAW,EAAEnB,IAAI,CAACU,OALK;IAMvBL,MAAM,EAAE,EACN,GAAGA,MADG;MAEN,GAAGI;IAFG;EANe,CAAzB;EAYA,OAAOP,GAAG,CAACJ,aAAJ,CAAkBa,gBAAlB,CAAP;AACD"}