{"version":3,"file":"changed-pages.js","names":["deletePage","actions","deleteUntouchedPages","currentPages","timeBeforeApisRan","shouldRunCreatePagesStatefully","deletedPages","forEach","page","isCreatedByStatefulCreatePages","updatedAt","store","dispatch","push","path","findChangedPages","oldPages","changedPages","compareWithoutUpdated","_left","_right","key","undefined","newPage","oldPage","get","_page","has"],"sources":["../../src/utils/changed-pages.ts"],"sourcesContent":["import { actions } from \"../redux/actions\"\nimport { store } from \"../redux\"\nconst { deletePage } = actions\nimport { isEqualWith } from \"lodash\"\nimport { IGatsbyPage } from \"../redux/types\"\nimport type { IsEqualCustomizer } from \"lodash\"\n\nexport function deleteUntouchedPages(\n  currentPages: Map<string, IGatsbyPage>,\n  timeBeforeApisRan: number,\n  shouldRunCreatePagesStatefully: boolean\n): Array<string> {\n  const deletedPages: Array<string> = []\n\n  // Delete pages that weren't updated when running createPages.\n  currentPages.forEach(page => {\n    if (\n      (shouldRunCreatePagesStatefully ||\n        !page.isCreatedByStatefulCreatePages) &&\n      page.updatedAt < timeBeforeApisRan\n    ) {\n      store.dispatch(deletePage(page))\n      deletedPages.push(page.path, `/page-data${page.path}`)\n    }\n  })\n  return deletedPages\n}\n\nexport function findChangedPages(\n  oldPages: Map<string, IGatsbyPage>,\n  currentPages: Map<string, IGatsbyPage>\n): {\n  changedPages: Array<string>\n  deletedPages: Array<string>\n} {\n  const changedPages: Array<string> = []\n\n  const compareWithoutUpdated: IsEqualCustomizer = (_left, _right, key) =>\n    key === `updatedAt` || undefined\n\n  currentPages.forEach((newPage, path) => {\n    const oldPage = oldPages.get(path)\n    if (!oldPage || !isEqualWith(newPage, oldPage, compareWithoutUpdated)) {\n      changedPages.push(path)\n    }\n  })\n  const deletedPages: Array<string> = []\n  oldPages.forEach((_page, key) => {\n    if (!currentPages.has(key)) {\n      deletedPages.push(key)\n    }\n  })\n\n  return { changedPages, deletedPages }\n}\n"],"mappings":";;;;;;;;;;AAAA;;AACA;;AACA,MAAM;EAAEA;AAAF,IAAiBC,gBAAvB;;AAKO,SAASC,oBAAT,CACLC,YADK,EAELC,iBAFK,EAGLC,8BAHK,EAIU;EACf,MAAMC,YAA2B,GAAG,EAApC,CADe,CAGf;;EACAH,YAAY,CAACI,OAAb,CAAqBC,IAAI,IAAI;IAC3B,IACE,CAACH,8BAA8B,IAC7B,CAACG,IAAI,CAACC,8BADR,KAEAD,IAAI,CAACE,SAAL,GAAiBN,iBAHnB,EAIE;MACAO,YAAA,CAAMC,QAAN,CAAeZ,UAAU,CAACQ,IAAD,CAAzB;;MACAF,YAAY,CAACO,IAAb,CAAkBL,IAAI,CAACM,IAAvB,EAA8B,aAAYN,IAAI,CAACM,IAAK,EAApD;IACD;EACF,CATD;EAUA,OAAOR,YAAP;AACD;;AAEM,SAASS,gBAAT,CACLC,QADK,EAELb,YAFK,EAML;EACA,MAAMc,YAA2B,GAAG,EAApC;;EAEA,MAAMC,qBAAwC,GAAG,CAACC,KAAD,EAAQC,MAAR,EAAgBC,GAAhB,KAC/CA,GAAG,KAAM,WAAT,IAAuBC,SADzB;;EAGAnB,YAAY,CAACI,OAAb,CAAqB,CAACgB,OAAD,EAAUT,IAAV,KAAmB;IACtC,MAAMU,OAAO,GAAGR,QAAQ,CAACS,GAAT,CAAaX,IAAb,CAAhB;;IACA,IAAI,CAACU,OAAD,IAAY,CAAC,2BAAYD,OAAZ,EAAqBC,OAArB,EAA8BN,qBAA9B,CAAjB,EAAuE;MACrED,YAAY,CAACJ,IAAb,CAAkBC,IAAlB;IACD;EACF,CALD;EAMA,MAAMR,YAA2B,GAAG,EAApC;EACAU,QAAQ,CAACT,OAAT,CAAiB,CAACmB,KAAD,EAAQL,GAAR,KAAgB;IAC/B,IAAI,CAAClB,YAAY,CAACwB,GAAb,CAAiBN,GAAjB,CAAL,EAA4B;MAC1Bf,YAAY,CAACO,IAAb,CAAkBQ,GAAlB;IACD;EACF,CAJD;EAMA,OAAO;IAAEJ,YAAF;IAAgBX;EAAhB,CAAP;AACD"}