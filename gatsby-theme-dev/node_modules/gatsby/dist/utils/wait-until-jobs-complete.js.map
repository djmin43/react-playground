{"version":3,"file":"wait-until-jobs-complete.js","names":["waitJobsV1","Promise","resolve","onEndJob","store","getState","jobs","active","length","emitter","off","on","waitUntilAllJobsComplete","all","waitUntilAllJobsV2Complete","then","waitJobsByRequest","requestId","jobsV2","jobDigests","Set","jobsByRequest","get","waitJobsV2"],"sources":["../../src/utils/wait-until-jobs-complete.ts"],"sourcesContent":["import { emitter, store } from \"../redux\"\n\nimport {\n  waitJobs as waitJobsV2,\n  waitUntilAllJobsComplete as waitUntilAllJobsV2Complete,\n} from \"./jobs/manager\"\n\nasync function waitJobsV1(): Promise<void> {\n  return new Promise<void>(resolve => {\n    const onEndJob = (): void => {\n      if (store.getState().jobs.active.length === 0) {\n        resolve()\n        emitter.off(`END_JOB`, onEndJob)\n      }\n    }\n\n    emitter.on(`END_JOB`, onEndJob)\n    onEndJob()\n  })\n}\n\nexport const waitUntilAllJobsComplete = (): Promise<void> =>\n  Promise.all([waitJobsV1(), waitUntilAllJobsV2Complete()]).then()\n\nexport async function waitJobsByRequest(requestId: string): Promise<void> {\n  const jobs = store.getState().jobsV2\n  const jobDigests = new Set([\n    ...(jobs.jobsByRequest.get(requestId) ?? []),\n    ...(jobs.jobsByRequest.get(``) ?? []), // wait for jobs without requestId just in case\n  ])\n  await Promise.all([waitJobsV1(), waitJobsV2(jobDigests)])\n}\n"],"mappings":";;;;;;AAAA;;AAEA;;AAKA,eAAeA,UAAf,GAA2C;EACzC,OAAO,IAAIC,OAAJ,CAAkBC,OAAO,IAAI;IAClC,MAAMC,QAAQ,GAAG,MAAY;MAC3B,IAAIC,YAAA,CAAMC,QAAN,GAAiBC,IAAjB,CAAsBC,MAAtB,CAA6BC,MAA7B,KAAwC,CAA5C,EAA+C;QAC7CN,OAAO;;QACPO,cAAA,CAAQC,GAAR,CAAa,SAAb,EAAuBP,QAAvB;MACD;IACF,CALD;;IAOAM,cAAA,CAAQE,EAAR,CAAY,SAAZ,EAAsBR,QAAtB;;IACAA,QAAQ;EACT,CAVM,CAAP;AAWD;;AAEM,MAAMS,wBAAwB,GAAG,MACtCX,OAAO,CAACY,GAAR,CAAY,CAACb,UAAU,EAAX,EAAe,IAAAc,iCAAA,GAAf,CAAZ,EAA0DC,IAA1D,EADK;;;;AAGA,eAAeC,iBAAf,CAAiCC,SAAjC,EAAmE;EAAA;;EACxE,MAAMX,IAAI,GAAGF,YAAA,CAAMC,QAAN,GAAiBa,MAA9B;;EACA,MAAMC,UAAU,GAAG,IAAIC,GAAJ,CAAQ,CACzB,6BAAId,IAAI,CAACe,aAAL,CAAmBC,GAAnB,CAAuBL,SAAvB,CAAJ,yEAAyC,EAAzC,CADyB,EAEzB,8BAAIX,IAAI,CAACe,aAAL,CAAmBC,GAAnB,CAAwB,EAAxB,CAAJ,2EAAkC,EAAlC,CAFyB,CAEc;EAFd,CAAR,CAAnB;EAIA,MAAMrB,OAAO,CAACY,GAAR,CAAY,CAACb,UAAU,EAAX,EAAe,IAAAuB,iBAAA,EAAWJ,UAAX,CAAf,CAAZ,CAAN;AACD"}