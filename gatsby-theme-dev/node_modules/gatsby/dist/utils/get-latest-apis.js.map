{"version":3,"file":"get-latest-apis.js","names":["API_FILE","ROOT","path","join","__dirname","OUTPUT_FILE","getLatestAPIs","data","axios","get","timeout","fs","writeFile","JSON","stringify","e","pathExists","readJSON","catch","browser","node","ssr"],"sources":["../../src/utils/get-latest-apis.ts"],"sourcesContent":["import path from \"path\"\nimport fs from \"fs-extra\"\nimport axios from \"axios\"\n\nconst API_FILE = `https://unpkg.com/gatsby/apis.json`\nconst ROOT = path.join(__dirname, `..`, `..`)\nconst OUTPUT_FILE = path.join(ROOT, `latest-apis.json`)\n\nexport interface IAPIResponse {\n  browser: Record<string, any>\n  node: Record<string, any>\n  ssr: Record<string, any>\n}\n\nexport const getLatestAPIs = async (): Promise<IAPIResponse> => {\n  try {\n    const { data } = await axios.get(API_FILE, { timeout: 5000 })\n\n    await fs.writeFile(OUTPUT_FILE, JSON.stringify(data, null, 2), `utf8`)\n\n    return data\n  } catch (e) {\n    if (await fs.pathExists(OUTPUT_FILE)) {\n      return fs.readJSON(OUTPUT_FILE)\n    }\n    // possible offline/network issue\n    return fs.readJSON(path.join(ROOT, `apis.json`)).catch(() => {\n      return {\n        browser: {},\n        node: {},\n        ssr: {},\n      }\n    })\n  }\n}\n"],"mappings":";;;;;;;AAAA;;AACA;;AACA;;AAEA,MAAMA,QAAQ,GAAI,oCAAlB;;AACA,MAAMC,IAAI,GAAGC,aAAA,CAAKC,IAAL,CAAUC,SAAV,EAAsB,IAAtB,EAA4B,IAA5B,CAAb;;AACA,MAAMC,WAAW,GAAGH,aAAA,CAAKC,IAAL,CAAUF,IAAV,EAAiB,kBAAjB,CAApB;;AAQO,MAAMK,aAAa,GAAG,YAAmC;EAC9D,IAAI;IACF,MAAM;MAAEC;IAAF,IAAW,MAAMC,cAAA,CAAMC,GAAN,CAAUT,QAAV,EAAoB;MAAEU,OAAO,EAAE;IAAX,CAApB,CAAvB;IAEA,MAAMC,gBAAA,CAAGC,SAAH,CAAaP,WAAb,EAA0BQ,IAAI,CAACC,SAAL,CAAeP,IAAf,EAAqB,IAArB,EAA2B,CAA3B,CAA1B,EAA0D,MAA1D,CAAN;IAEA,OAAOA,IAAP;EACD,CAND,CAME,OAAOQ,CAAP,EAAU;IACV,IAAI,MAAMJ,gBAAA,CAAGK,UAAH,CAAcX,WAAd,CAAV,EAAsC;MACpC,OAAOM,gBAAA,CAAGM,QAAH,CAAYZ,WAAZ,CAAP;IACD,CAHS,CAIV;;;IACA,OAAOM,gBAAA,CAAGM,QAAH,CAAYf,aAAA,CAAKC,IAAL,CAAUF,IAAV,EAAiB,WAAjB,CAAZ,EAA0CiB,KAA1C,CAAgD,MAAM;MAC3D,OAAO;QACLC,OAAO,EAAE,EADJ;QAELC,IAAI,EAAE,EAFD;QAGLC,GAAG,EAAE;MAHA,CAAP;IAKD,CANM,CAAP;EAOD;AACF,CApBM"}