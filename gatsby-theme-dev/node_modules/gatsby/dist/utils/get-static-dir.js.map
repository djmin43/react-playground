{"version":3,"file":"get-static-dir.js","names":["copyStaticDirs","flattenedPlugins","store","getState","themesSet","map","plugin","themeDir","pluginFilepath","themeName","name","theme","nodePath","resolve","filter","themeStaticPath","fs","existsSync","folder","copySync","join","process","cwd","dereference","staticDir","undefined","syncStaticDir","chokidar","watch","on","path","relativePath","relative","copy"],"sources":["../../src/utils/get-static-dir.ts"],"sourcesContent":["import fs from \"fs-extra\"\nimport chokidar from \"chokidar\"\nimport nodePath from \"path\"\nimport { store } from \"../redux\"\n\n/**\n * copyStaticDirs\n * --\n * Copy files from the static directory to the public directory\n */\nexport const copyStaticDirs = (): void => {\n  // access the store to get themes\n  const { flattenedPlugins } = store.getState()\n  // if there are legacy themes, only use them. Otherwise proceed with plugins\n  const themesSet = flattenedPlugins.map(plugin => {\n    return {\n      themeDir: plugin.pluginFilepath,\n      themeName: plugin.name,\n    }\n  })\n\n  themesSet\n    // create an array of potential theme static folders\n    .map(theme => nodePath.resolve(theme.themeDir, `static`))\n    // filter out the static folders that don't exist\n    .filter(themeStaticPath => fs.existsSync(themeStaticPath))\n    // copy the files for each folder into the user's build\n    .map(folder =>\n      fs.copySync(folder, nodePath.join(process.cwd(), `public`), {\n        dereference: true,\n      })\n    )\n\n  const staticDir = nodePath.join(process.cwd(), `static`)\n  if (!fs.existsSync(staticDir)) return undefined\n  return fs.copySync(staticDir, nodePath.join(process.cwd(), `public`), {\n    dereference: true,\n  })\n}\n\n/**\n * syncStaticDir\n * --\n * Set up a watcher to sync changes from the static directory to the public directory\n */\nexport const syncStaticDir = (): void => {\n  const staticDir = nodePath.join(process.cwd(), `static`)\n  chokidar\n    .watch(staticDir)\n    .on(`add`, path => {\n      const relativePath = nodePath.relative(staticDir, path)\n      fs.copy(path, `${process.cwd()}/public/${relativePath}`)\n    })\n    .on(`change`, path => {\n      const relativePath = nodePath.relative(staticDir, path)\n      fs.copy(path, `${process.cwd()}/public/${relativePath}`)\n    })\n}\n"],"mappings":";;;;;;;AAAA;;AACA;;AACA;;AACA;;AAEA;AACA;AACA;AACA;AACA;AACO,MAAMA,cAAc,GAAG,MAAY;EACxC;EACA,MAAM;IAAEC;EAAF,IAAuBC,YAAA,CAAMC,QAAN,EAA7B,CAFwC,CAGxC;;;EACA,MAAMC,SAAS,GAAGH,gBAAgB,CAACI,GAAjB,CAAqBC,MAAM,IAAI;IAC/C,OAAO;MACLC,QAAQ,EAAED,MAAM,CAACE,cADZ;MAELC,SAAS,EAAEH,MAAM,CAACI;IAFb,CAAP;EAID,CALiB,CAAlB;EAOAN,SAAS,CACP;EADO,CAENC,GAFH,CAEOM,KAAK,IAAIC,aAAA,CAASC,OAAT,CAAiBF,KAAK,CAACJ,QAAvB,EAAkC,QAAlC,CAFhB,EAGE;EAHF,CAIGO,MAJH,CAIUC,eAAe,IAAIC,gBAAA,CAAGC,UAAH,CAAcF,eAAd,CAJ7B,EAKE;EALF,CAMGV,GANH,CAMOa,MAAM,IACTF,gBAAA,CAAGG,QAAH,CAAYD,MAAZ,EAAoBN,aAAA,CAASQ,IAAT,CAAcC,OAAO,CAACC,GAAR,EAAd,EAA8B,QAA9B,CAApB,EAA4D;IAC1DC,WAAW,EAAE;EAD6C,CAA5D,CAPJ;;EAYA,MAAMC,SAAS,GAAGZ,aAAA,CAASQ,IAAT,CAAcC,OAAO,CAACC,GAAR,EAAd,EAA8B,QAA9B,CAAlB;;EACA,IAAI,CAACN,gBAAA,CAAGC,UAAH,CAAcO,SAAd,CAAL,EAA+B,OAAOC,SAAP;EAC/B,OAAOT,gBAAA,CAAGG,QAAH,CAAYK,SAAZ,EAAuBZ,aAAA,CAASQ,IAAT,CAAcC,OAAO,CAACC,GAAR,EAAd,EAA8B,QAA9B,CAAvB,EAA+D;IACpEC,WAAW,EAAE;EADuD,CAA/D,CAAP;AAGD,CA5BM;AA8BP;AACA;AACA;AACA;AACA;;;;;AACO,MAAMG,aAAa,GAAG,MAAY;EACvC,MAAMF,SAAS,GAAGZ,aAAA,CAASQ,IAAT,CAAcC,OAAO,CAACC,GAAR,EAAd,EAA8B,QAA9B,CAAlB;;EACAK,iBAAA,CACGC,KADH,CACSJ,SADT,EAEGK,EAFH,CAEO,KAFP,EAEaC,IAAI,IAAI;IACjB,MAAMC,YAAY,GAAGnB,aAAA,CAASoB,QAAT,CAAkBR,SAAlB,EAA6BM,IAA7B,CAArB;;IACAd,gBAAA,CAAGiB,IAAH,CAAQH,IAAR,EAAe,GAAET,OAAO,CAACC,GAAR,EAAc,WAAUS,YAAa,EAAtD;EACD,CALH,EAMGF,EANH,CAMO,QANP,EAMgBC,IAAI,IAAI;IACpB,MAAMC,YAAY,GAAGnB,aAAA,CAASoB,QAAT,CAAkBR,SAAlB,EAA6BM,IAA7B,CAArB;;IACAd,gBAAA,CAAGiB,IAAH,CAAQH,IAAR,EAAe,GAAET,OAAO,CAACC,GAAR,EAAc,WAAUS,YAAa,EAAtD;EACD,CATH;AAUD,CAZM"}