{"version":3,"file":"engine-context.js","names":["asyncLocalStorage","getAsyncLocalStorage","AsyncLocalStorage","getEngineContext","getStore","runWithEngineContext","context","fn","run"],"sources":["../../src/utils/engine-context.ts"],"sourcesContent":["import { AsyncLocalStorage } from \"async_hooks\"\n\nexport interface IEngineContext {\n  requestId: string\n}\n\nlet asyncLocalStorage\nfunction getAsyncLocalStorage(): AsyncLocalStorage<IEngineContext> {\n  return asyncLocalStorage ?? (asyncLocalStorage = new AsyncLocalStorage())\n}\n\nexport function getEngineContext(): IEngineContext | undefined {\n  return getAsyncLocalStorage().getStore()\n}\n\nexport function runWithEngineContext<T>(\n  context: IEngineContext,\n  fn: (...args: Array<any>) => T\n): T {\n  // @ts-ignore typings are incorrect, run() returns the result of fn()\n  return getAsyncLocalStorage().run(context, fn)\n}\n"],"mappings":";;;;;;AAAA;;AAMA,IAAIA,iBAAJ;;AACA,SAASC,oBAAT,GAAmE;EAAA;;EACjE,6BAAOD,iBAAP,mEAA6BA,iBAAiB,GAAG,IAAIE,8BAAJ,EAAjD;AACD;;AAEM,SAASC,gBAAT,GAAwD;EAC7D,OAAOF,oBAAoB,GAAGG,QAAvB,EAAP;AACD;;AAEM,SAASC,oBAAT,CACLC,OADK,EAELC,EAFK,EAGF;EACH;EACA,OAAON,oBAAoB,GAAGO,GAAvB,CAA2BF,OAA3B,EAAoCC,EAApC,CAAP;AACD"}