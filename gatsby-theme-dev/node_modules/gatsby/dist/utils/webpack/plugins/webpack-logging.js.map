{"version":3,"file":"webpack-logging.js","names":["WebpackLoggingPlugin","PLUGIN_NAME","isVerbose","constructor","rootDir","reporter","apply","compiler","options","infrastructureLogging","level","debug","profile","ProgressPlugin","webpackBundleAnalyzerPath","resolveFrom","silent","hooks","beforeRun","tapPromise","then","BundleAnalyzerPlugin","analyzerMode","openAnalyzer","title","name","reportFilename","done","tap","stats","log","toString","colors","logging"],"sources":["../../../../src/utils/webpack/plugins/webpack-logging.ts"],"sourcesContent":["import { ProgressPlugin } from \"webpack\"\nimport resolveFrom from \"resolve-from\"\nimport type reporter from \"gatsby-cli/lib/reporter\"\nimport type { Compiler } from \"webpack\"\n\ntype Reporter = typeof reporter\n\nexport class WebpackLoggingPlugin {\n  private PLUGIN_NAME = `WebpackLogging`\n  private rootDir: string\n  private reporter: Reporter\n  private isVerbose = false\n\n  constructor(rootDir: string, reporter: Reporter, isVerbose = false) {\n    this.rootDir = rootDir\n    this.reporter = reporter\n    this.isVerbose = isVerbose\n  }\n\n  apply(compiler: Compiler): void {\n    compiler.options.infrastructureLogging = {\n      level: `verbose`,\n      debug: /FileSystemInfo/,\n    }\n    compiler.options.profile = true\n\n    new ProgressPlugin({\n      profile: true,\n    }).apply(compiler)\n\n    // if webpack bundle analyzer is installed lets use it\n    const webpackBundleAnalyzerPath = resolveFrom.silent(\n      this.rootDir,\n      `webpack-bundle-analyzer`\n    )\n    if (webpackBundleAnalyzerPath) {\n      compiler.hooks.beforeRun.tapPromise(this.PLUGIN_NAME, () =>\n        import(webpackBundleAnalyzerPath).then(({ BundleAnalyzerPlugin }) => {\n          new BundleAnalyzerPlugin({\n            analyzerMode: `static`,\n            openAnalyzer: false,\n            title: compiler.name,\n            reportFilename: `report.html`,\n          }).apply(compiler)\n        })\n      )\n    }\n\n    compiler.hooks.done.tap(this.PLUGIN_NAME, stats => {\n      this.reporter.log(\n        stats.toString({\n          colors: true,\n          logging: this.isVerbose ? `verbose` : `log`,\n        })\n      )\n    })\n  }\n}\n"],"mappings":";;;;;;;AAAA;;AACA;;;;;;AAMO,MAAMA,oBAAN,CAA2B;EACxBC,WAAW,GAAI,gBAAJ;EAGXC,SAAS,GAAG,KAAH;;EAEjBC,WAAW,CAACC,OAAD,EAAkBC,QAAlB,EAAsCH,SAAS,GAAG,KAAlD,EAAyD;IAClE,KAAKE,OAAL,GAAeA,OAAf;IACA,KAAKC,QAAL,GAAgBA,QAAhB;IACA,KAAKH,SAAL,GAAiBA,SAAjB;EACD;;EAEDI,KAAK,CAACC,QAAD,EAA2B;IAC9BA,QAAQ,CAACC,OAAT,CAAiBC,qBAAjB,GAAyC;MACvCC,KAAK,EAAG,SAD+B;MAEvCC,KAAK,EAAE;IAFgC,CAAzC;IAIAJ,QAAQ,CAACC,OAAT,CAAiBI,OAAjB,GAA2B,IAA3B;IAEA,IAAIC,uBAAJ,CAAmB;MACjBD,OAAO,EAAE;IADQ,CAAnB,EAEGN,KAFH,CAESC,QAFT,EAP8B,CAW9B;;IACA,MAAMO,yBAAyB,GAAGC,oBAAA,CAAYC,MAAZ,CAChC,KAAKZ,OAD2B,EAE/B,yBAF+B,CAAlC;;IAIA,IAAIU,yBAAJ,EAA+B;MAC7BP,QAAQ,CAACU,KAAT,CAAeC,SAAf,CAAyBC,UAAzB,CAAoC,KAAKlB,WAAzC,EAAsD,MACpD,mBAAOa,yBAAP,mDAAkCM,IAAlC,CAAuC,CAAC;QAAEC;MAAF,CAAD,KAA8B;QACnE,IAAIA,oBAAJ,CAAyB;UACvBC,YAAY,EAAG,QADQ;UAEvBC,YAAY,EAAE,KAFS;UAGvBC,KAAK,EAAEjB,QAAQ,CAACkB,IAHO;UAIvBC,cAAc,EAAG;QAJM,CAAzB,EAKGpB,KALH,CAKSC,QALT;MAMD,CAPD,CADF;IAUD;;IAEDA,QAAQ,CAACU,KAAT,CAAeU,IAAf,CAAoBC,GAApB,CAAwB,KAAK3B,WAA7B,EAA0C4B,KAAK,IAAI;MACjD,KAAKxB,QAAL,CAAcyB,GAAd,CACED,KAAK,CAACE,QAAN,CAAe;QACbC,MAAM,EAAE,IADK;QAEbC,OAAO,EAAE,KAAK/B,SAAL,GAAkB,SAAlB,GAA8B;MAF1B,CAAf,CADF;IAMD,CAPD;EAQD;;AAjD+B"}