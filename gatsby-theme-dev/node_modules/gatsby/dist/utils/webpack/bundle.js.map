{"version":3,"file":"bundle.js","names":["build","webpackConfig","compiler","webpack","Promise","resolve","reject","run","err","stats","close","hasErrors","compilation","errors","watch","onWatch","watchOptions","watcher"],"sources":["../../../src/utils/webpack/bundle.ts"],"sourcesContent":["import webpack from \"webpack\"\n\nexport function build(webpackConfig: webpack.Configuration): Promise<{\n  stats: webpack.Stats\n  close: () => Promise<void>\n}> {\n  const compiler = webpack(webpackConfig)\n\n  return new Promise((resolve, reject) => {\n    compiler.run((err, stats) => {\n      // stats can only be empty when an error occurs. Adding it to the if makes typescript happy.\n      if (err || !stats) {\n        return compiler.close(() => {\n          reject(err)\n        })\n      }\n\n      if (stats.hasErrors()) {\n        return compiler.close(() => {\n          reject(stats.compilation.errors)\n        })\n      }\n\n      return resolve({\n        stats,\n        close: (): Promise<void> =>\n          new Promise((resolve, reject) =>\n            compiler.close(err => (err ? reject(err) : resolve()))\n          ),\n      })\n    })\n  })\n}\n\nexport function watch(\n  webpackConfig: webpack.Configuration,\n  onWatch: (\n    err: Error | webpack.WebpackError | undefined,\n    stats: webpack.Stats | undefined\n  ) => void,\n  watchOptions: webpack.Watching[\"watchOptions\"] = {}\n): {\n  watcher: webpack.Watching\n  close: () => Promise<void>\n} {\n  const compiler = webpack(webpackConfig)\n\n  const watcher = compiler.watch(watchOptions, (err, stats) => {\n    // this runs multiple times\n    onWatch(err, stats)\n  })\n\n  return {\n    watcher,\n    close: (): Promise<void> =>\n      new Promise((resolve, reject) =>\n        watcher.close(err => (err ? reject(err) : resolve()))\n      ),\n  }\n}\n"],"mappings":";;;;;;;;AAAA;;AAEO,SAASA,KAAT,CAAeC,aAAf,EAGJ;EACD,MAAMC,QAAQ,GAAG,IAAAC,gBAAA,EAAQF,aAAR,CAAjB;EAEA,OAAO,IAAIG,OAAJ,CAAY,CAACC,OAAD,EAAUC,MAAV,KAAqB;IACtCJ,QAAQ,CAACK,GAAT,CAAa,CAACC,GAAD,EAAMC,KAAN,KAAgB;MAC3B;MACA,IAAID,GAAG,IAAI,CAACC,KAAZ,EAAmB;QACjB,OAAOP,QAAQ,CAACQ,KAAT,CAAe,MAAM;UAC1BJ,MAAM,CAACE,GAAD,CAAN;QACD,CAFM,CAAP;MAGD;;MAED,IAAIC,KAAK,CAACE,SAAN,EAAJ,EAAuB;QACrB,OAAOT,QAAQ,CAACQ,KAAT,CAAe,MAAM;UAC1BJ,MAAM,CAACG,KAAK,CAACG,WAAN,CAAkBC,MAAnB,CAAN;QACD,CAFM,CAAP;MAGD;;MAED,OAAOR,OAAO,CAAC;QACbI,KADa;QAEbC,KAAK,EAAE,MACL,IAAIN,OAAJ,CAAY,CAACC,OAAD,EAAUC,MAAV,KACVJ,QAAQ,CAACQ,KAAT,CAAeF,GAAG,IAAKA,GAAG,GAAGF,MAAM,CAACE,GAAD,CAAT,GAAiBH,OAAO,EAAlD,CADF;MAHW,CAAD,CAAd;IAOD,CArBD;EAsBD,CAvBM,CAAP;AAwBD;;AAEM,SAASS,KAAT,CACLb,aADK,EAELc,OAFK,EAMLC,YAA8C,GAAG,EAN5C,EAUL;EACA,MAAMd,QAAQ,GAAG,IAAAC,gBAAA,EAAQF,aAAR,CAAjB;EAEA,MAAMgB,OAAO,GAAGf,QAAQ,CAACY,KAAT,CAAeE,YAAf,EAA6B,CAACR,GAAD,EAAMC,KAAN,KAAgB;IAC3D;IACAM,OAAO,CAACP,GAAD,EAAMC,KAAN,CAAP;EACD,CAHe,CAAhB;EAKA,OAAO;IACLQ,OADK;IAELP,KAAK,EAAE,MACL,IAAIN,OAAJ,CAAY,CAACC,OAAD,EAAUC,MAAV,KACVW,OAAO,CAACP,KAAR,CAAcF,GAAG,IAAKA,GAAG,GAAGF,MAAM,CAACE,GAAD,CAAT,GAAiBH,OAAO,EAAjD,CADF;EAHG,CAAP;AAOD"}