{"version":3,"file":"file-parser.js","names":["fs","require","crypto","_","slugify","getGraphQLTag","StringInterpolationNotAllowedError","EmptyGraphQLTagError","GraphQLSyntaxError","ExportIsNotAsyncError","isWithinConfigExport","report","apiRunnerNode","actions","store","generateQueryName","def","hash","file","queryType","name","value","slugified","replacement","lower","camelCase","kind","followVariableDeclarations","binding","node","path","type","id","init","scope","getBinding","referencesGatsby","callee","calleeName","referencesImport","declaration","arguments","isUseStaticQuery","property","get","object","warnForUnknownQueryVariable","varName","usageFunction","warn","parseToAst","filePath","fileStr","parentSpan","addError","ast","transpiled","filename","contents","length","item","tmp","babelParseToAst","error","undefined","context","dispatch","queryExtractionGraphQLError","componentPath","queryExtractionBabelError","panicOnGlobalTag","panicOnBuild","findApiExport","api","hasExport","apiToFind","traverse","ExportNamedDeclaration","t","isExportNamedDeclaration","specifiers","some","specifier","isExportSpecifier","isIdentifier","exported","apiToCheck","isFunctionDeclaration","isVariableDeclaration","declarations","findGraphQLTags","documents","documentLocations","WeakMap","extractStaticQuery","taggedTemplateExpressPath","isHook","gqlAst","text","isGlobal","definitions","forEach","templateLoc","TemplateElement","templateElementPath","loc","docInFile","doc","isStaticQuery","isConfigQuery","set","start","push","JSXElement","openingElement","JSXAttribute","jsxPath","TaggedTemplateExpression","templatePath","Identifier","identifierPath","found","VariableDeclarator","varPath","CallExpression","hookPath","firstArg","isTaggedTemplateExpression","innerPath","state","source","ExportSpecifier","local","uniqueQueries","uniqBy","q","cache","FileParser","constructor","parseFile","readFile","err","includes","createHash","update","digest","astDefinitions","serverData","config","Head","payload","queryExtractedBabelSuccess","structuredError","location","interpolationStart","end","interpolationEnd","codeFrame","codeFrameColumns","highlightCode","process","env","FORCE_COLOR","locInGraphQlToLocInFile","originalError","locations","message","sourceMessage","exportStart","exportName","parseFiles","files","Promise","all","map","then","docs"],"sources":["../../src/query/file-parser.js"],"sourcesContent":["/* eslint-disable no-unused-expressions */\n// @flow\nconst fs = require(`fs-extra`)\nconst crypto = require(`crypto`)\nconst _ = require(`lodash`)\nconst slugify = require(`slugify`)\n\n// Traverse is a es6 module...\nimport traverse from \"@babel/traverse\"\nimport * as t from \"@babel/types\"\nconst {\n  getGraphQLTag,\n  StringInterpolationNotAllowedError,\n  EmptyGraphQLTagError,\n  GraphQLSyntaxError,\n  ExportIsNotAsyncError,\n  isWithinConfigExport,\n} = require(`babel-plugin-remove-graphql-queries`)\n\nconst report = require(`gatsby-cli/lib/reporter`)\n\nimport type { DocumentNode } from \"graphql\"\nimport { babelParseToAst } from \"../utils/babel-parse-to-ast\"\nimport { codeFrameColumns } from \"@babel/code-frame\"\n\nconst apiRunnerNode = require(`../utils/api-runner-node`)\nconst { actions } = require(`../redux/actions`)\nconst { store } = require(`../redux`)\nimport { locInGraphQlToLocInFile } from \"./error-parser\"\n/**\n * Add autogenerated query name if it wasn't defined by user.\n */\nconst generateQueryName = ({ def, hash, file, queryType }) => {\n  if (!def.name || !def.name.value) {\n    const slugified = slugify(file, {\n      replacement: ` `,\n      lower: false,\n    })\n    def.name = {\n      value: `${_.camelCase(`${queryType}-${slugified}-${hash}`)}`,\n      kind: `Name`,\n    }\n  }\n  return def\n}\n\n// taken from `babel-plugin-remove-graphql-queries`, in the future import from\n// there\nfunction followVariableDeclarations(binding) {\n  const node = binding?.path?.node\n  if (\n    node?.type === `VariableDeclarator` &&\n    node?.id.type === `Identifier` &&\n    node?.init?.type === `Identifier`\n  ) {\n    return followVariableDeclarations(\n      binding.path.scope.getBinding(node.init.name)\n    )\n  }\n  return binding\n}\n\nfunction referencesGatsby(path, callee, calleeName) {\n  // This works for es6 imports\n  if (callee.referencesImport(`gatsby`, ``)) {\n    return true\n  } else {\n    // This finds where userStaticQuery was declared and then checks\n    // if it is a \"require\" and \"gatsby\" is the argument.\n    const declaration = path.scope.getBinding(calleeName)\n    if (\n      declaration &&\n      declaration.path.node.init?.callee.name === `require` &&\n      declaration.path.node.init.arguments[0].value === `gatsby`\n    ) {\n      return true\n    } else {\n      return false\n    }\n  }\n}\n\nfunction isUseStaticQuery(path) {\n  const callee = path.node.callee\n  if (callee.type === `MemberExpression`) {\n    const property = callee.property\n    if (property.name === `useStaticQuery`) {\n      return referencesGatsby(\n        path,\n        path.get(`callee`).get(`object`),\n        path.node?.callee.object.name\n      )\n    }\n    return false\n  }\n  if (callee.name === `useStaticQuery`) {\n    return referencesGatsby(path, path.get(`callee`), path.node?.callee.name)\n  }\n  return false\n}\n\nconst warnForUnknownQueryVariable = (varName, file, usageFunction) =>\n  report.warn(\n    `\\nWe were unable to find the declaration of variable \"${varName}\", which you passed as the \"query\" prop into the ${usageFunction} declaration in \"${file}\".\n\nPerhaps the variable name has a typo?\n\nAlso note that we are currently unable to use queries defined in files other than the file where the ${usageFunction} is defined. If you're attempting to import the query, please move it into \"${file}\". If being able to import queries from another file is an important capability for you, we invite your help fixing it.\\n`\n  )\n\nasync function parseToAst(filePath, fileStr, { parentSpan, addError } = {}) {\n  let ast\n\n  // Preprocess and attempt to parse source; return an AST if we can, log an\n  // error if we can't.\n  const transpiled = await apiRunnerNode(`preprocessSource`, {\n    filename: filePath,\n    contents: fileStr,\n    parentSpan,\n  })\n\n  if (transpiled && transpiled.length) {\n    for (const item of transpiled) {\n      try {\n        const tmp = babelParseToAst(item, filePath)\n        ast = tmp\n        break\n      } catch (error) {\n        // We emit the actual error below if every transpiled variant fails to parse\n      }\n    }\n    if (ast === undefined) {\n      addError({\n        id: `85912`,\n        filePath,\n        context: {\n          filePath,\n        },\n      })\n      store.dispatch(\n        actions.queryExtractionGraphQLError({\n          componentPath: filePath,\n        })\n      )\n\n      return null\n    }\n  } else {\n    try {\n      ast = babelParseToAst(fileStr, filePath)\n    } catch (error) {\n      store.dispatch(\n        actions.queryExtractionBabelError({\n          componentPath: filePath,\n          error,\n        })\n      )\n\n      addError({\n        id: `85911`,\n        filePath,\n        context: {\n          filePath,\n        },\n      })\n\n      return null\n    }\n  }\n\n  return ast\n}\n\nconst panicOnGlobalTag = file =>\n  report.panicOnBuild(\n    `Using the global \\`graphql\\` tag for Gatsby's queries isn't supported as of v3.\\n` +\n      `Import it instead like:  import { graphql } from 'gatsby' in file:\\n` +\n      file\n  )\n\ntype GraphQLDocumentInFile = {\n  filePath: string,\n  doc: DocumentNode,\n  templateLoc: string,\n  text: string,\n  hash: string,\n  isHook: boolean,\n  isStaticQuery: boolean,\n}\n\n// Adapted from gatsby/src/utils/babel/babel-plugin-remove-api\nfunction findApiExport(ast, api) {\n  let hasExport = false\n  const apiToFind = api ?? ``\n\n  traverse(ast, {\n    ExportNamedDeclaration(path) {\n      const declaration = path.node.declaration\n\n      if (t.isExportNamedDeclaration(path.node) && !hasExport) {\n        hasExport = path.node.specifiers.some(\n          specifier =>\n            t.isExportSpecifier(specifier) &&\n            t.isIdentifier(specifier.exported) &&\n            specifier.exported.name === apiToFind\n        )\n      }\n\n      let apiToCheck\n      if (t.isFunctionDeclaration(declaration) && declaration.id) {\n        apiToCheck = declaration.id.name\n      }\n\n      if (\n        t.isVariableDeclaration(declaration) &&\n        t.isIdentifier(declaration.declarations[0].id)\n      ) {\n        apiToCheck = declaration.declarations[0].id.name\n      }\n\n      if (apiToCheck && apiToCheck === apiToFind) {\n        hasExport = true\n      }\n    },\n  })\n\n  return hasExport\n}\n\nasync function findGraphQLTags(\n  file,\n  ast,\n  { parentSpan, addError } = {}\n): Promise<Array<GraphQLDocumentInFile>> {\n  const documents = []\n  if (!ast) {\n    return documents\n  }\n\n  /**\n   * A map of graphql documents to unique locations.\n   *\n   * A graphql document's unique location is made of:\n   *\n   *  - the location of the graphql template literal that contains the document, and\n   *  - the document's location within the graphql template literal\n   *\n   * This is used to prevent returning duplicated documents.\n   */\n  const documentLocations = new WeakMap()\n\n  const extractStaticQuery = (taggedTemplateExpressPath, isHook = false) => {\n    const {\n      ast: gqlAst,\n      text,\n      hash,\n      isGlobal,\n    } = getGraphQLTag(taggedTemplateExpressPath)\n    if (!gqlAst) return\n\n    if (isGlobal) {\n      panicOnGlobalTag(file)\n      return\n    }\n\n    gqlAst.definitions.forEach(def => {\n      generateQueryName({\n        def,\n        hash,\n        file,\n        queryType: `static`,\n      })\n    })\n\n    let templateLoc\n\n    taggedTemplateExpressPath.traverse({\n      TemplateElement(templateElementPath) {\n        templateLoc = templateElementPath.node.loc\n      },\n    })\n\n    const docInFile = {\n      filePath: file,\n      doc: gqlAst,\n      text: text,\n      hash: hash,\n      isStaticQuery: true,\n      isConfigQuery: false,\n      isHook,\n      templateLoc,\n    }\n\n    documentLocations.set(\n      docInFile,\n      `${taggedTemplateExpressPath.node.start}-${gqlAst.loc.start}`\n    )\n\n    documents.push(docInFile)\n  }\n\n  // Look for queries in <StaticQuery /> elements.\n  traverse(ast, {\n    JSXElement(path) {\n      if (path.node.openingElement.name.name !== `StaticQuery`) {\n        return\n      }\n\n      // astexplorer.com link I (@kyleamathews) used when prototyping this algorithm\n      // https://astexplorer.net/#/gist/ab5d71c0f08f287fbb840bf1dd8b85ff/2f188345d8e5a4152fe7c96f0d52dbcc6e9da466\n      path.traverse({\n        JSXAttribute(jsxPath) {\n          if (jsxPath.node.name.name !== `query`) {\n            return\n          }\n          jsxPath.traverse({\n            // Assume the query is inline in the component and extract that.\n            TaggedTemplateExpression(templatePath) {\n              extractStaticQuery(templatePath)\n            },\n            // Also see if it's a variable that's passed in as a prop\n            // and if it is, go find it.\n            Identifier(identifierPath) {\n              if (identifierPath.node.name !== `graphql`) {\n                const varName = identifierPath.node.name\n                let found = false\n                traverse(ast, {\n                  VariableDeclarator(varPath) {\n                    if (\n                      varPath.node.id.name === varName &&\n                      varPath.node.init.type === `TaggedTemplateExpression`\n                    ) {\n                      varPath.traverse({\n                        TaggedTemplateExpression(templatePath) {\n                          found = true\n                          extractStaticQuery(templatePath)\n                        },\n                      })\n                    }\n                  },\n                })\n                if (!found) {\n                  warnForUnknownQueryVariable(varName, file, `<StaticQuery>`)\n                }\n              }\n            },\n          })\n        },\n      })\n      return\n    },\n  })\n\n  // Look for queries in useStaticQuery hooks.\n  traverse(ast, {\n    CallExpression(hookPath) {\n      if (!isUseStaticQuery(hookPath)) return\n\n      const firstArg = hookPath.get(`arguments`)[0]\n\n      // Assume the query is inline in the component and extract that.\n      if (firstArg.isTaggedTemplateExpression()) {\n        extractStaticQuery(firstArg, true)\n        // Also see if it's a variable that's passed in as a prop\n        // and if it is, go find it.\n      } else if (firstArg.isIdentifier()) {\n        if (\n          firstArg.node.name !== `graphql` &&\n          firstArg.node.name !== `useStaticQuery`\n        ) {\n          const varName = firstArg.node.name\n          let found = false\n          traverse(ast, {\n            VariableDeclarator(varPath) {\n              if (\n                varPath.node.id.name === varName &&\n                varPath.node.init.type === `TaggedTemplateExpression`\n              ) {\n                varPath.traverse({\n                  TaggedTemplateExpression(templatePath) {\n                    found = true\n                    extractStaticQuery(templatePath, true)\n                  },\n                })\n              }\n            },\n          })\n          if (!found) {\n            warnForUnknownQueryVariable(varName, file, `useStaticQuery`)\n          }\n        }\n      }\n    },\n  })\n\n  function TaggedTemplateExpression(innerPath) {\n    const { ast: gqlAst, isGlobal, hash, text } = getGraphQLTag(innerPath)\n    if (!gqlAst) return\n\n    if (isGlobal) {\n      panicOnGlobalTag(file)\n      return\n    }\n\n    const isConfigQuery = isWithinConfigExport(innerPath)\n\n    gqlAst.definitions.forEach(def => {\n      generateQueryName({\n        def,\n        hash,\n        file,\n        queryType: isConfigQuery ? `config` : `page`,\n      })\n    })\n\n    let templateLoc\n    innerPath.traverse({\n      TemplateElement(templateElementPath) {\n        templateLoc = templateElementPath.node.loc\n      },\n    })\n\n    const docInFile = {\n      filePath: file,\n      doc: gqlAst,\n      text: text,\n      hash: hash,\n      isStaticQuery: false,\n      isConfigQuery,\n      isHook: false,\n      templateLoc,\n    }\n\n    documentLocations.set(\n      docInFile,\n      `${innerPath.node.start}-${gqlAst.loc.start}`\n    )\n\n    documents.push(docInFile)\n  }\n\n  // When a component has a StaticQuery we scan all of its exports and follow those exported variables\n  // to determine if they lead to this static query (via tagged template literal)\n  traverse(ast, {\n    ExportNamedDeclaration(path, state) {\n      // Skipping the edge case of re-exporting (i.e. \"export { bar } from 'Bar'\")\n      // (it is handled elsewhere for queries, see usages of warnForUnknownQueryVariable)\n      if (path.node.source) {\n        return\n      }\n      path.traverse({\n        TaggedTemplateExpression,\n        ExportSpecifier(path) {\n          const binding = followVariableDeclarations(\n            path.scope.getBinding(path.node.local.name)\n          )\n          binding?.path?.traverse({ TaggedTemplateExpression })\n        },\n      })\n    },\n  })\n\n  // Remove duplicate queries\n  const uniqueQueries = _.uniqBy(documents, q => documentLocations.get(q))\n\n  return uniqueQueries\n}\n\nconst cache = {}\n\nexport default class FileParser {\n  constructor({ parentSpan } = {}) {\n    this.parentSpan = parentSpan\n  }\n\n  async parseFile(\n    file: string,\n    addError\n  ): Promise<?Array<GraphQLDocumentInFile>> {\n    let text\n    try {\n      text = await fs.readFile(file, `utf8`)\n    } catch (err) {\n      addError({\n        id: `85913`,\n        filePath: file,\n        context: {\n          filePath: file,\n        },\n        error: err,\n      })\n\n      store.dispatch(\n        actions.queryExtractionGraphQLError({\n          componentPath: file,\n        })\n      )\n      return null\n    }\n\n    // We do a quick check so we can exit early if this is a file we're not interested in.\n    // We only process files that either include graphql, or static images\n    if (\n      !text.includes(`graphql`) &&\n      !text.includes(`gatsby-plugin-image`) &&\n      !text.includes(`getServerData`) &&\n      !text.includes(`config`)\n    ) {\n      return null\n    }\n\n    const hash = crypto\n      .createHash(`md5`)\n      .update(file)\n      .update(text)\n      .digest(`hex`)\n\n    try {\n      if (!cache[hash]) {\n        const ast = await parseToAst(file, text, {\n          parentSpan: this.parentSpan,\n          addError,\n        })\n        cache[hash] = {\n          astDefinitions: await findGraphQLTags(file, ast, {\n            parentSpan: this.parentSpan,\n            addError,\n          }),\n          serverData: findApiExport(ast, `getServerData`),\n          config: findApiExport(ast, `config`),\n          Head: findApiExport(ast, `Head`),\n        }\n      }\n      const { astDefinitions, serverData, config, Head } = cache[hash]\n\n      // Note: we should dispatch this action even when getServerData is not found\n      // (maybe it was set before, so now we need to reset renderMode from SSR to the default one)\n      store.dispatch({\n        type: `SET_COMPONENT_FEATURES`,\n        payload: {\n          componentPath: file,\n          serverData,\n          config,\n          Head,\n        },\n      })\n\n      // If any AST definitions were extracted, report success.\n      // This can mean there is none or there was a babel error when\n      // we tried to extract the graphql AST.\n      if (astDefinitions.length > 0) {\n        store.dispatch(\n          actions.queryExtractedBabelSuccess({\n            componentPath: file,\n          })\n        )\n      }\n\n      return astDefinitions\n    } catch (err) {\n      // default error\n      let structuredError = {\n        id: `85915`,\n        context: {\n          filePath: file,\n        },\n      }\n\n      if (err instanceof StringInterpolationNotAllowedError) {\n        const location = {\n          start: err.interpolationStart,\n          end: err.interpolationEnd,\n        }\n        structuredError = {\n          id: `85916`,\n          location,\n          context: {\n            codeFrame: codeFrameColumns(text, location, {\n              highlightCode: process.env.FORCE_COLOR !== `0`,\n            }),\n          },\n        }\n      } else if (err instanceof EmptyGraphQLTagError) {\n        const location = err.templateLoc\n          ? {\n              start: err.templateLoc.start,\n              end: err.templateLoc.end,\n            }\n          : null\n\n        structuredError = {\n          id: `85917`,\n          location,\n          context: {\n            codeFrame: location\n              ? codeFrameColumns(text, location, {\n                  highlightCode: process.env.FORCE_COLOR !== `0`,\n                })\n              : null,\n          },\n        }\n      } else if (err instanceof GraphQLSyntaxError) {\n        const location = {\n          start: locInGraphQlToLocInFile(\n            err.templateLoc,\n            err.originalError.locations[0]\n          ),\n        }\n\n        structuredError = {\n          id: `85918`,\n          location,\n          context: {\n            codeFrame: location\n              ? codeFrameColumns(text, location, {\n                  highlightCode: process.env.FORCE_COLOR !== `0`,\n                  message: err.originalError.message,\n                })\n              : null,\n            sourceMessage: err.originalError.message,\n          },\n        }\n      } else if (err instanceof ExportIsNotAsyncError) {\n        const location = {\n          start: err.exportStart,\n          end: err.exportStart,\n        }\n        structuredError = {\n          id: `85929`,\n          location,\n          context: {\n            exportName: err.exportName,\n            codeFrame: codeFrameColumns(text, location, {\n              highlightCode: process.env.FORCE_COLOR !== `0`,\n            }),\n          },\n        }\n      }\n\n      addError({\n        ...structuredError,\n        filePath: file,\n      })\n\n      store.dispatch(\n        actions.queryExtractionGraphQLError({\n          componentPath: file,\n        })\n      )\n      return null\n    }\n  }\n\n  async parseFiles(\n    files: Array<string>,\n    addError\n  ): Promise<Array<GraphQLDocumentInFile>> {\n    const documents = []\n\n    return Promise.all(\n      files.map(file =>\n        this.parseFile(file, addError).then(docs => {\n          documents.push(...(docs || []))\n        })\n      )\n    ).then(() => documents)\n  }\n}\n"],"mappings":"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"}