{"version":3,"file":"handle-gatsby-cloud.js","names":["GATSBY_CLOUD_PLUGIN_NAME","GATSBY_PLUGIN_PREVIEW_NAME","addCloudPluginWhenInstalled","plugins","rootDir","name","cloudPluginLocation","resolveFromSilent","processedGatsbyCloudPlugin","processPlugin","resolve","options","push","addGatsbyPluginPreviewWhenInstalled","addGatsbyPluginCloudPluginWhenInstalled","incompatibleGatsbyCloudPlugin","plugin","find","semver","satisfies","version","includePrerelease"],"sources":["../../../../src/bootstrap/load-plugins/utils/handle-gatsby-cloud.ts"],"sourcesContent":["import { silent as resolveFromSilent } from \"resolve-from\"\nimport * as semver from \"semver\"\nimport { IPluginInfo } from \"../types\"\nimport { processPlugin } from \"../process-plugin\"\n\nexport const GATSBY_CLOUD_PLUGIN_NAME = `gatsby-plugin-gatsby-cloud`\nexport const GATSBY_PLUGIN_PREVIEW_NAME = `@gatsby-cloud-pkg/gatsby-plugin-preview`\n\nfunction addCloudPluginWhenInstalled(\n  plugins: Array<IPluginInfo>,\n  rootDir: string,\n  name: string\n): void {\n  const cloudPluginLocation = resolveFromSilent(rootDir, name)\n\n  if (cloudPluginLocation) {\n    const processedGatsbyCloudPlugin = processPlugin(\n      {\n        resolve: name,\n        options: {},\n      },\n      rootDir\n    )\n    plugins.push(processedGatsbyCloudPlugin)\n  }\n}\n\nexport function addGatsbyPluginPreviewWhenInstalled(\n  plugins: Array<IPluginInfo>,\n  rootDir: string\n): void {\n  addCloudPluginWhenInstalled(plugins, rootDir, GATSBY_PLUGIN_PREVIEW_NAME)\n}\n\nexport function addGatsbyPluginCloudPluginWhenInstalled(\n  plugins: Array<IPluginInfo>,\n  rootDir: string\n): void {\n  addCloudPluginWhenInstalled(plugins, rootDir, GATSBY_CLOUD_PLUGIN_NAME)\n}\n\nexport function incompatibleGatsbyCloudPlugin(\n  plugins: Array<IPluginInfo>\n): boolean {\n  const plugin = plugins.find(\n    plugin => plugin.name === GATSBY_CLOUD_PLUGIN_NAME\n  )\n\n  return !semver.satisfies(plugin!.version, `>=4.0.0-alpha`, {\n    includePrerelease: true,\n  })\n}\n"],"mappings":";;;;;;;;AAAA;;AACA;;AAEA;;;;;;AAEO,MAAMA,wBAAwB,GAAI,4BAAlC;;AACA,MAAMC,0BAA0B,GAAI,yCAApC;;;AAEP,SAASC,2BAAT,CACEC,OADF,EAEEC,OAFF,EAGEC,IAHF,EAIQ;EACN,MAAMC,mBAAmB,GAAG,IAAAC,mBAAA,EAAkBH,OAAlB,EAA2BC,IAA3B,CAA5B;;EAEA,IAAIC,mBAAJ,EAAyB;IACvB,MAAME,0BAA0B,GAAG,IAAAC,4BAAA,EACjC;MACEC,OAAO,EAAEL,IADX;MAEEM,OAAO,EAAE;IAFX,CADiC,EAKjCP,OALiC,CAAnC;IAOAD,OAAO,CAACS,IAAR,CAAaJ,0BAAb;EACD;AACF;;AAEM,SAASK,mCAAT,CACLV,OADK,EAELC,OAFK,EAGC;EACNF,2BAA2B,CAACC,OAAD,EAAUC,OAAV,EAAmBH,0BAAnB,CAA3B;AACD;;AAEM,SAASa,uCAAT,CACLX,OADK,EAELC,OAFK,EAGC;EACNF,2BAA2B,CAACC,OAAD,EAAUC,OAAV,EAAmBJ,wBAAnB,CAA3B;AACD;;AAEM,SAASe,6BAAT,CACLZ,OADK,EAEI;EACT,MAAMa,MAAM,GAAGb,OAAO,CAACc,IAAR,CACbD,MAAM,IAAIA,MAAM,CAACX,IAAP,KAAgBL,wBADb,CAAf;EAIA,OAAO,CAACkB,MAAM,CAACC,SAAP,CAAiBH,MAAM,CAAEI,OAAzB,EAAmC,eAAnC,EAAmD;IACzDC,iBAAiB,EAAE;EADsC,CAAnD,CAAR;AAGD"}