{"version":3,"file":"check-local-plugin.js","names":["checkLocalPlugin","plugin","rootDir","pluginName","resolve","existsSync","validLocalPlugin","resolvedPath","slash","path","join","resolvedPackageJson","Error","localPluginPath"],"sources":["../../../../src/bootstrap/load-plugins/utils/check-local-plugin.ts"],"sourcesContent":["import { PluginRef } from \"../types\"\nimport { sync as existsSync } from \"fs-exists-cached\"\nimport { slash } from \"gatsby-core-utils\"\nimport path from \"path\"\n\n/**\n * Checks if a plugin is a valid local plugin and returns the resolved path if it is.\n */\nexport function checkLocalPlugin(\n  plugin: PluginRef,\n  rootDir: string\n): { validLocalPlugin: boolean; localPluginPath?: string } {\n  const pluginName = typeof plugin === `string` ? plugin : plugin.resolve\n\n  // Make sure the plugin exists relatively\n  if (existsSync(pluginName) || !rootDir) {\n    return {\n      validLocalPlugin: false,\n    }\n  }\n\n  const resolvedPath = slash(path.join(rootDir, `plugins/${pluginName}`))\n\n  if (!existsSync(resolvedPath)) {\n    return {\n      validLocalPlugin: false,\n    }\n  }\n\n  const resolvedPackageJson = existsSync(`${resolvedPath}/package.json`)\n\n  // package.json is a requirement for local plugins\n  if (!resolvedPackageJson) {\n    throw new Error(`Local plugin ${pluginName} requires a package.json file`)\n  }\n\n  return {\n    validLocalPlugin: true,\n    localPluginPath: resolvedPath,\n  }\n}\n"],"mappings":";;;;;;;AACA;;AACA;;AACA;;AAEA;AACA;AACA;AACO,SAASA,gBAAT,CACLC,MADK,EAELC,OAFK,EAGoD;EACzD,MAAMC,UAAU,GAAG,OAAOF,MAAP,KAAmB,QAAnB,GAA6BA,MAA7B,GAAsCA,MAAM,CAACG,OAAhE,CADyD,CAGzD;;EACA,IAAI,IAAAC,oBAAA,EAAWF,UAAX,KAA0B,CAACD,OAA/B,EAAwC;IACtC,OAAO;MACLI,gBAAgB,EAAE;IADb,CAAP;EAGD;;EAED,MAAMC,YAAY,GAAG,IAAAC,sBAAA,EAAMC,aAAA,CAAKC,IAAL,CAAUR,OAAV,EAAoB,WAAUC,UAAW,EAAzC,CAAN,CAArB;;EAEA,IAAI,CAAC,IAAAE,oBAAA,EAAWE,YAAX,CAAL,EAA+B;IAC7B,OAAO;MACLD,gBAAgB,EAAE;IADb,CAAP;EAGD;;EAED,MAAMK,mBAAmB,GAAG,IAAAN,oBAAA,EAAY,GAAEE,YAAa,eAA3B,CAA5B,CAlByD,CAoBzD;;EACA,IAAI,CAACI,mBAAL,EAA0B;IACxB,MAAM,IAAIC,KAAJ,CAAW,gBAAeT,UAAW,+BAArC,CAAN;EACD;;EAED,OAAO;IACLG,gBAAgB,EAAE,IADb;IAELO,eAAe,EAAEN;EAFZ,CAAP;AAID"}