{"version":3,"file":"flatten-plugins.js","names":["flattenPlugins","plugins","flattened","extractPlugins","plugin","subPluginPaths","subPluginPath","segments","split","roots","pluginOptions","segment","flat","map","root","forEach","subPlugin","push"],"sources":["../../../../src/bootstrap/load-plugins/utils/flatten-plugins.ts"],"sourcesContent":["import { IPluginInfo } from \"../types\"\n\n// Create a \"flattened\" array of plugins with all subplugins\n// brought to the top-level. This simplifies running gatsby-* files\n// for subplugins.\nexport const flattenPlugins = (\n  plugins: Array<IPluginInfo>\n): Array<IPluginInfo> => {\n  const flattened: Array<IPluginInfo> = []\n  const extractPlugins = (plugin: IPluginInfo): void => {\n    if (plugin.subPluginPaths) {\n      for (const subPluginPath of plugin.subPluginPaths) {\n        // @pieh:\n        // subPluginPath can look like someOption.randomFieldThatIsMarkedAsSubplugins\n        // Reason for doing stringified path with . separator was that it was just easier to prevent duplicates\n        // in subPluginPaths array (as each subplugin in the gatsby-config would add subplugin path).\n        const segments = subPluginPath.split(`.`)\n        let roots: Array<any> = [plugin.pluginOptions]\n        for (const segment of segments) {\n          if (segment === `[]`) {\n            roots = roots.flat()\n          } else {\n            roots = roots.map(root => root[segment])\n          }\n        }\n        roots = roots.flat()\n\n        roots.forEach(subPlugin => {\n          flattened.push(subPlugin)\n          extractPlugins(subPlugin)\n        })\n      }\n    }\n  }\n\n  plugins.forEach(plugin => {\n    flattened.push(plugin)\n    extractPlugins(plugin)\n  })\n\n  return flattened\n}\n"],"mappings":";;;;;AAEA;AACA;AACA;AACO,MAAMA,cAAc,GACzBC,OAD4B,IAEL;EACvB,MAAMC,SAA6B,GAAG,EAAtC;;EACA,MAAMC,cAAc,GAAIC,MAAD,IAA+B;IACpD,IAAIA,MAAM,CAACC,cAAX,EAA2B;MACzB,KAAK,MAAMC,aAAX,IAA4BF,MAAM,CAACC,cAAnC,EAAmD;QACjD;QACA;QACA;QACA;QACA,MAAME,QAAQ,GAAGD,aAAa,CAACE,KAAd,CAAqB,GAArB,CAAjB;QACA,IAAIC,KAAiB,GAAG,CAACL,MAAM,CAACM,aAAR,CAAxB;;QACA,KAAK,MAAMC,OAAX,IAAsBJ,QAAtB,EAAgC;UAC9B,IAAII,OAAO,KAAM,IAAjB,EAAsB;YACpBF,KAAK,GAAGA,KAAK,CAACG,IAAN,EAAR;UACD,CAFD,MAEO;YACLH,KAAK,GAAGA,KAAK,CAACI,GAAN,CAAUC,IAAI,IAAIA,IAAI,CAACH,OAAD,CAAtB,CAAR;UACD;QACF;;QACDF,KAAK,GAAGA,KAAK,CAACG,IAAN,EAAR;QAEAH,KAAK,CAACM,OAAN,CAAcC,SAAS,IAAI;UACzBd,SAAS,CAACe,IAAV,CAAeD,SAAf;UACAb,cAAc,CAACa,SAAD,CAAd;QACD,CAHD;MAID;IACF;EACF,CAxBD;;EA0BAf,OAAO,CAACc,OAAR,CAAgBX,MAAM,IAAI;IACxBF,SAAS,CAACe,IAAV,CAAeb,MAAf;IACAD,cAAc,CAACC,MAAD,CAAd;EACD,CAHD;EAKA,OAAOF,SAAP;AACD,CApCM"}