{"version":3,"file":"remove-stale-jobs.js","names":["removeStaleJobs","jobs","actions","complete","forEach","job","contentDigest","isJobStale","push","internalActions","removeStaleJob","incomplete","createJobV2FromInternalJob"],"sources":["../../src/bootstrap/remove-stale-jobs.ts"],"sourcesContent":["import {\n  IGatsbyState,\n  IRemoveStaleJobV2Action,\n  ICreateJobV2FromInternalAction,\n} from \"../redux/types\"\n\nimport { isJobStale } from \"../utils/jobs/manager\"\nimport { internalActions } from \"../redux/actions\"\n\nexport const removeStaleJobs = (\n  jobs: IGatsbyState[\"jobsV2\"]\n): Array<IRemoveStaleJobV2Action | ICreateJobV2FromInternalAction> => {\n  const actions: Array<\n    IRemoveStaleJobV2Action | ICreateJobV2FromInternalAction\n  > = []\n\n  // If any of our finished jobs are stale we remove them to keep our cache small\n  jobs.complete.forEach((job, contentDigest) => {\n    if (isJobStale(job)) {\n      actions.push(internalActions.removeStaleJob(contentDigest))\n    }\n  })\n\n  // If any of our pending jobs do not have an existing inputPath or the inputPath changed\n  // we remove it from the queue as they would fail anyway\n  jobs.incomplete.forEach(({ job }): void => {\n    if (isJobStale(job)) {\n      actions.push(internalActions.removeStaleJob(job.contentDigest))\n    } else {\n      actions.push(internalActions.createJobV2FromInternalJob(job))\n    }\n  })\n\n  return actions\n}\n"],"mappings":";;;;;AAMA;;AACA;;AAEO,MAAMA,eAAe,GAC1BC,IAD6B,IAEuC;EACpE,MAAMC,OAEL,GAAG,EAFJ,CADoE,CAKpE;;EACAD,IAAI,CAACE,QAAL,CAAcC,OAAd,CAAsB,CAACC,GAAD,EAAMC,aAAN,KAAwB;IAC5C,IAAI,IAAAC,mBAAA,EAAWF,GAAX,CAAJ,EAAqB;MACnBH,OAAO,CAACM,IAAR,CAAaC,wBAAA,CAAgBC,cAAhB,CAA+BJ,aAA/B,CAAb;IACD;EACF,CAJD,EANoE,CAYpE;EACA;;EACAL,IAAI,CAACU,UAAL,CAAgBP,OAAhB,CAAwB,CAAC;IAAEC;EAAF,CAAD,KAAmB;IACzC,IAAI,IAAAE,mBAAA,EAAWF,GAAX,CAAJ,EAAqB;MACnBH,OAAO,CAACM,IAAR,CAAaC,wBAAA,CAAgBC,cAAhB,CAA+BL,GAAG,CAACC,aAAnC,CAAb;IACD,CAFD,MAEO;MACLJ,OAAO,CAACM,IAAR,CAAaC,wBAAA,CAAgBG,0BAAhB,CAA2CP,GAA3C,CAAb;IACD;EACF,CAND;EAQA,OAAOH,OAAP;AACD,CAzBM"}