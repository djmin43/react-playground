{"version":3,"file":"add-page-dependency.js","names":["createPageDependencyBatcher","Batcher","bulkCall","createCalls","dependencyPayloads","map","call","store","dispatch","internalCreatePageDependencies","createPageDependency","path","nodeId","connection","queries","getState","nodeDependencyExists","connectionDependencyExists","byNode","has","get","byConnection","add"],"sources":["../../../src/redux/actions/add-page-dependency.ts"],"sourcesContent":["import { store } from \"../\"\nimport Batcher from \"../../utils/batcher\"\nimport {\n  createPageDependency as internalCreatePageDependency,\n  createPageDependencies as internalCreatePageDependencies,\n} from \"./internal\"\n\nexport const createPageDependencyBatcher = new Batcher<\n  typeof internalCreatePageDependency\n>(1000)\n\ncreatePageDependencyBatcher.bulkCall(createCalls => {\n  const dependencyPayloads = createCalls.map(call => call[0])\n  store.dispatch(internalCreatePageDependencies(dependencyPayloads))\n})\n\nexport const createPageDependency = ({\n  path,\n  nodeId,\n  connection,\n}: {\n  path: string\n  nodeId: string\n  connection?: string\n}): void => {\n  const { queries } = store.getState()\n\n  // Check that the dependencies aren't already recorded so we\n  // can avoid creating lots of very noisy actions.\n  let nodeDependencyExists = false\n  let connectionDependencyExists = false\n  if (!nodeId) {\n    nodeDependencyExists = true\n  }\n  if (\n    nodeId &&\n    queries.byNode.has(nodeId) &&\n    queries.byNode.get(nodeId)!.has(path)\n  ) {\n    nodeDependencyExists = true\n  }\n  if (!connection) {\n    connectionDependencyExists = true\n  }\n  if (\n    connection &&\n    queries.byConnection.has(connection) &&\n    queries.byConnection.get(connection)!.has(path)\n  ) {\n    connectionDependencyExists = true\n  }\n  if (nodeDependencyExists && connectionDependencyExists) {\n    return\n  }\n\n  // It's new, let's dispatch it\n  createPageDependencyBatcher.add({ path, nodeId, connection })\n}\n"],"mappings":";;;;;;;AAAA;;AACA;;AACA;;AAKO,MAAMA,2BAA2B,GAAG,IAAIC,gBAAJ,CAEzC,IAFyC,CAApC;;AAIPD,2BAA2B,CAACE,QAA5B,CAAqCC,WAAW,IAAI;EAClD,MAAMC,kBAAkB,GAAGD,WAAW,CAACE,GAAZ,CAAgBC,IAAI,IAAIA,IAAI,CAAC,CAAD,CAA5B,CAA3B;;EACAC,OAAA,CAAMC,QAAN,CAAe,IAAAC,gCAAA,EAA+BL,kBAA/B,CAAf;AACD,CAHD;;AAKO,MAAMM,oBAAoB,GAAG,CAAC;EACnCC,IADmC;EAEnCC,MAFmC;EAGnCC;AAHmC,CAAD,KAQxB;EACV,MAAM;IAAEC;EAAF,IAAcP,OAAA,CAAMQ,QAAN,EAApB,CADU,CAGV;EACA;;;EACA,IAAIC,oBAAoB,GAAG,KAA3B;EACA,IAAIC,0BAA0B,GAAG,KAAjC;;EACA,IAAI,CAACL,MAAL,EAAa;IACXI,oBAAoB,GAAG,IAAvB;EACD;;EACD,IACEJ,MAAM,IACNE,OAAO,CAACI,MAAR,CAAeC,GAAf,CAAmBP,MAAnB,CADA,IAEAE,OAAO,CAACI,MAAR,CAAeE,GAAf,CAAmBR,MAAnB,EAA4BO,GAA5B,CAAgCR,IAAhC,CAHF,EAIE;IACAK,oBAAoB,GAAG,IAAvB;EACD;;EACD,IAAI,CAACH,UAAL,EAAiB;IACfI,0BAA0B,GAAG,IAA7B;EACD;;EACD,IACEJ,UAAU,IACVC,OAAO,CAACO,YAAR,CAAqBF,GAArB,CAAyBN,UAAzB,CADA,IAEAC,OAAO,CAACO,YAAR,CAAqBD,GAArB,CAAyBP,UAAzB,EAAsCM,GAAtC,CAA0CR,IAA1C,CAHF,EAIE;IACAM,0BAA0B,GAAG,IAA7B;EACD;;EACD,IAAID,oBAAoB,IAAIC,0BAA5B,EAAwD;IACtD;EACD,CA7BS,CA+BV;;;EACAjB,2BAA2B,CAACsB,GAA5B,CAAgC;IAAEX,IAAF;IAAQC,MAAR;IAAgBC;EAAhB,CAAhC;AACD,CAzCM"}