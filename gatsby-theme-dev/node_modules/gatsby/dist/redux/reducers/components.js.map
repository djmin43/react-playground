{"version":3,"file":"components.js","names":["programStatus","componentsReducer","state","Map","action","type","payload","component","get","componentPath","componentChunkName","query","pages","Set","isInBootstrap","serverData","config","add","path","set","normalize","delete"],"sources":["../../../src/redux/reducers/components.ts"],"sourcesContent":["import normalize from \"../../utils/normalize-path\"\nimport { IGatsbyState, ActionsUnion } from \"../types\"\n\nlet programStatus = `BOOTSTRAPPING`\n\n// TODO: replace usages of this reducer with queries.trackedComponents\n//  It is here merely for compatibility.\nexport const componentsReducer = (\n  state: IGatsbyState[\"components\"] = new Map(),\n  action: ActionsUnion\n): IGatsbyState[\"components\"] => {\n  switch (action.type) {\n    case `DELETE_CACHE`:\n      return new Map()\n    case `SET_PROGRAM_STATUS`:\n      programStatus = action.payload\n      return state\n    case `CREATE_PAGE`: {\n      // Create XState service.\n      let component = state.get(action.payload.componentPath)\n      if (!component) {\n        component = {\n          componentPath: action.payload.componentPath,\n          componentChunkName: action.payload.componentChunkName,\n          query: ``,\n          pages: new Set(),\n          isInBootstrap: true,\n          serverData: false,\n          config: false,\n        }\n      }\n      component.pages.add(action.payload.path)\n      component.isInBootstrap = programStatus === `BOOTSTRAPPING`\n      state.set(action.payload.componentPath, component)\n      return state\n    }\n    case `QUERY_EXTRACTED`: {\n      action.payload.componentPath = normalize(action.payload.componentPath)\n      const component = state.get(action.payload.componentPath)!\n      component.query = action.payload.query\n      state.set(action.payload.componentPath, component)\n      return state\n    }\n    case `REMOVE_STATIC_QUERIES_BY_TEMPLATE`: {\n      action.payload.componentPath = normalize(action.payload.componentPath)\n      state.delete(action.payload.componentPath)\n      return state\n    }\n    case `SET_COMPONENT_FEATURES`: {\n      const path = normalize(action.payload.componentPath)\n      const component = state.get(path)\n      if (component) {\n        component.serverData = action.payload.serverData\n        component.config = action.payload.config\n      }\n      return state\n    }\n    case `DELETE_PAGE`: {\n      const component = state.get(normalize(action.payload.component))!\n      component.pages.delete(action.payload.path)\n      return state\n    }\n  }\n\n  return state\n}\n"],"mappings":";;;;;;;AAAA;;AAGA,IAAIA,aAAa,GAAI,eAArB,C,CAEA;AACA;;AACO,MAAMC,iBAAiB,GAAG,CAC/BC,KAAiC,GAAG,IAAIC,GAAJ,EADL,EAE/BC,MAF+B,KAGA;EAC/B,QAAQA,MAAM,CAACC,IAAf;IACE,KAAM,cAAN;MACE,OAAO,IAAIF,GAAJ,EAAP;;IACF,KAAM,oBAAN;MACEH,aAAa,GAAGI,MAAM,CAACE,OAAvB;MACA,OAAOJ,KAAP;;IACF,KAAM,aAAN;MAAoB;QAClB;QACA,IAAIK,SAAS,GAAGL,KAAK,CAACM,GAAN,CAAUJ,MAAM,CAACE,OAAP,CAAeG,aAAzB,CAAhB;;QACA,IAAI,CAACF,SAAL,EAAgB;UACdA,SAAS,GAAG;YACVE,aAAa,EAAEL,MAAM,CAACE,OAAP,CAAeG,aADpB;YAEVC,kBAAkB,EAAEN,MAAM,CAACE,OAAP,CAAeI,kBAFzB;YAGVC,KAAK,EAAG,EAHE;YAIVC,KAAK,EAAE,IAAIC,GAAJ,EAJG;YAKVC,aAAa,EAAE,IALL;YAMVC,UAAU,EAAE,KANF;YAOVC,MAAM,EAAE;UAPE,CAAZ;QASD;;QACDT,SAAS,CAACK,KAAV,CAAgBK,GAAhB,CAAoBb,MAAM,CAACE,OAAP,CAAeY,IAAnC;QACAX,SAAS,CAACO,aAAV,GAA0Bd,aAAa,KAAM,eAA7C;QACAE,KAAK,CAACiB,GAAN,CAAUf,MAAM,CAACE,OAAP,CAAeG,aAAzB,EAAwCF,SAAxC;QACA,OAAOL,KAAP;MACD;;IACD,KAAM,iBAAN;MAAwB;QACtBE,MAAM,CAACE,OAAP,CAAeG,aAAf,GAA+B,IAAAW,sBAAA,EAAUhB,MAAM,CAACE,OAAP,CAAeG,aAAzB,CAA/B;QACA,MAAMF,SAAS,GAAGL,KAAK,CAACM,GAAN,CAAUJ,MAAM,CAACE,OAAP,CAAeG,aAAzB,CAAlB;QACAF,SAAS,CAACI,KAAV,GAAkBP,MAAM,CAACE,OAAP,CAAeK,KAAjC;QACAT,KAAK,CAACiB,GAAN,CAAUf,MAAM,CAACE,OAAP,CAAeG,aAAzB,EAAwCF,SAAxC;QACA,OAAOL,KAAP;MACD;;IACD,KAAM,mCAAN;MAA0C;QACxCE,MAAM,CAACE,OAAP,CAAeG,aAAf,GAA+B,IAAAW,sBAAA,EAAUhB,MAAM,CAACE,OAAP,CAAeG,aAAzB,CAA/B;QACAP,KAAK,CAACmB,MAAN,CAAajB,MAAM,CAACE,OAAP,CAAeG,aAA5B;QACA,OAAOP,KAAP;MACD;;IACD,KAAM,wBAAN;MAA+B;QAC7B,MAAMgB,IAAI,GAAG,IAAAE,sBAAA,EAAUhB,MAAM,CAACE,OAAP,CAAeG,aAAzB,CAAb;QACA,MAAMF,SAAS,GAAGL,KAAK,CAACM,GAAN,CAAUU,IAAV,CAAlB;;QACA,IAAIX,SAAJ,EAAe;UACbA,SAAS,CAACQ,UAAV,GAAuBX,MAAM,CAACE,OAAP,CAAeS,UAAtC;UACAR,SAAS,CAACS,MAAV,GAAmBZ,MAAM,CAACE,OAAP,CAAeU,MAAlC;QACD;;QACD,OAAOd,KAAP;MACD;;IACD,KAAM,aAAN;MAAoB;QAClB,MAAMK,SAAS,GAAGL,KAAK,CAACM,GAAN,CAAU,IAAAY,sBAAA,EAAUhB,MAAM,CAACE,OAAP,CAAeC,SAAzB,CAAV,CAAlB;QACAA,SAAS,CAACK,KAAV,CAAgBS,MAAhB,CAAuBjB,MAAM,CAACE,OAAP,CAAeY,IAAtC;QACA,OAAOhB,KAAP;MACD;EAlDH;;EAqDA,OAAOA,KAAP;AACD,CA1DM"}