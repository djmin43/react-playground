{"version":3,"file":"nodes-by-type.js","names":["getNodesOfType","node","state","type","internal","has","set","Map","nodeByType","get","Error","nodesByTypeReducer","action","payload","nodesOfType","id","delete","size"],"sources":["../../../src/redux/reducers/nodes-by-type.ts"],"sourcesContent":["import { IGatsbyNode, IGatsbyState, ActionsUnion } from \"../types\"\n\nconst getNodesOfType = (\n  node: IGatsbyNode,\n  state: IGatsbyState[\"nodesByType\"]\n): Map<string, IGatsbyNode> => {\n  const { type } = node.internal\n  if (!state.has(type)) {\n    state.set(type, new Map())\n  }\n  const nodeByType = state.get(type)\n\n  if (!nodeByType) {\n    throw new Error(\n      `An error occurred finding a node by it's type. This is likely a bug in gatsby. If you experience this error please open an issue.`\n    )\n  }\n\n  return nodeByType\n}\n\nexport const nodesByTypeReducer = (\n  state: IGatsbyState[\"nodesByType\"] = new Map(),\n  action: ActionsUnion\n): IGatsbyState[\"nodesByType\"] => {\n  switch (action.type) {\n    case `DELETE_CACHE`:\n      return new Map()\n\n    case `CREATE_NODE`: {\n      const node = action.payload\n      const nodesOfType = getNodesOfType(node, state)\n      nodesOfType.set(node.id, node)\n      return state\n    }\n\n    case `ADD_FIELD_TO_NODE`:\n    case `ADD_CHILD_NODE_TO_PARENT_NODE`: {\n      const node = action.payload\n      const nodesOfType = getNodesOfType(node, state)\n      nodesOfType.set(node.id, node)\n      return state\n    }\n\n    case `DELETE_NODE`: {\n      const node = action.payload\n      if (!node) return state\n      const nodesOfType = getNodesOfType(node, state)\n      nodesOfType.delete(node.id)\n      if (!nodesOfType.size) {\n        state.delete(node.internal.type)\n      }\n      return state\n    }\n\n    default:\n      return state\n  }\n}\n"],"mappings":";;;;;AAEA,MAAMA,cAAc,GAAG,CACrBC,IADqB,EAErBC,KAFqB,KAGQ;EAC7B,MAAM;IAAEC;EAAF,IAAWF,IAAI,CAACG,QAAtB;;EACA,IAAI,CAACF,KAAK,CAACG,GAAN,CAAUF,IAAV,CAAL,EAAsB;IACpBD,KAAK,CAACI,GAAN,CAAUH,IAAV,EAAgB,IAAII,GAAJ,EAAhB;EACD;;EACD,MAAMC,UAAU,GAAGN,KAAK,CAACO,GAAN,CAAUN,IAAV,CAAnB;;EAEA,IAAI,CAACK,UAAL,EAAiB;IACf,MAAM,IAAIE,KAAJ,CACH,mIADG,CAAN;EAGD;;EAED,OAAOF,UAAP;AACD,CAjBD;;AAmBO,MAAMG,kBAAkB,GAAG,CAChCT,KAAkC,GAAG,IAAIK,GAAJ,EADL,EAEhCK,MAFgC,KAGA;EAChC,QAAQA,MAAM,CAACT,IAAf;IACE,KAAM,cAAN;MACE,OAAO,IAAII,GAAJ,EAAP;;IAEF,KAAM,aAAN;MAAoB;QAClB,MAAMN,IAAI,GAAGW,MAAM,CAACC,OAApB;QACA,MAAMC,WAAW,GAAGd,cAAc,CAACC,IAAD,EAAOC,KAAP,CAAlC;QACAY,WAAW,CAACR,GAAZ,CAAgBL,IAAI,CAACc,EAArB,EAAyBd,IAAzB;QACA,OAAOC,KAAP;MACD;;IAED,KAAM,mBAAN;IACA,KAAM,+BAAN;MAAsC;QACpC,MAAMD,IAAI,GAAGW,MAAM,CAACC,OAApB;QACA,MAAMC,WAAW,GAAGd,cAAc,CAACC,IAAD,EAAOC,KAAP,CAAlC;QACAY,WAAW,CAACR,GAAZ,CAAgBL,IAAI,CAACc,EAArB,EAAyBd,IAAzB;QACA,OAAOC,KAAP;MACD;;IAED,KAAM,aAAN;MAAoB;QAClB,MAAMD,IAAI,GAAGW,MAAM,CAACC,OAApB;QACA,IAAI,CAACZ,IAAL,EAAW,OAAOC,KAAP;QACX,MAAMY,WAAW,GAAGd,cAAc,CAACC,IAAD,EAAOC,KAAP,CAAlC;QACAY,WAAW,CAACE,MAAZ,CAAmBf,IAAI,CAACc,EAAxB;;QACA,IAAI,CAACD,WAAW,CAACG,IAAjB,EAAuB;UACrBf,KAAK,CAACc,MAAN,CAAaf,IAAI,CAACG,QAAL,CAAcD,IAA3B;QACD;;QACD,OAAOD,KAAP;MACD;;IAED;MACE,OAAOA,KAAP;EA/BJ;AAiCD,CArCM"}