{"version":3,"file":"in-memory-datastore.js","names":["getNodes","nodes","store","getState","Map","Array","from","values","getNodesByType","type","nodesByType","get","iterateNodes","GatsbyIterable","iterateNodesByType","getNode","id","getTypes","keys","sort","countNodes","typeName","size","runQuery","args","Promise","resolve","runFastFiltersAndSort","readyPromise","undefined","ready","setupInMemoryStore"],"sources":["../../../src/datastore/in-memory/in-memory-datastore.ts"],"sourcesContent":["import { IDataStore, IQueryResult } from \"../types\"\nimport { store } from \"../../redux\"\nimport { IGatsbyNode } from \"../../redux/types\"\nimport { GatsbyIterable } from \"../common/iterable\"\nimport { IRunFilterArg, runFastFiltersAndSort } from \"./run-fast-filters\"\n\n/**\n * @deprecated\n */\nfunction getNodes(): Array<IGatsbyNode> {\n  const nodes = store.getState().nodes ?? new Map()\n  return Array.from(nodes.values())\n}\n\n/**\n * @deprecated\n */\nfunction getNodesByType(type: string): Array<IGatsbyNode> {\n  const nodes = store.getState().nodesByType.get(type) ?? new Map()\n  return Array.from(nodes.values())\n}\n\nfunction iterateNodes(): GatsbyIterable<IGatsbyNode> {\n  const nodes = store.getState().nodes ?? new Map()\n  return new GatsbyIterable(nodes.values())\n}\n\nfunction iterateNodesByType(type: string): GatsbyIterable<IGatsbyNode> {\n  const nodes = store.getState().nodesByType.get(type) ?? new Map()\n  return new GatsbyIterable(nodes.values())\n}\n\nfunction getNode(id: string): IGatsbyNode | undefined {\n  return store.getState().nodes.get(id)\n}\n\nfunction getTypes(): Array<string> {\n  // Note: sorting to match the output of the LMDB version (where keys are sorted by default)\n  return Array.from(store.getState().nodesByType.keys()).sort()\n}\n\nfunction countNodes(typeName?: string): number {\n  if (!typeName) {\n    return store.getState().nodes.size\n  }\n  const nodes = store.getState().nodesByType.get(typeName)\n  return nodes ? nodes.size : 0\n}\n\nfunction runQuery(args: IRunFilterArg): Promise<IQueryResult> {\n  return Promise.resolve(runFastFiltersAndSort(args))\n}\n\nconst readyPromise = Promise.resolve(undefined)\n\n/**\n * Returns promise that resolves when the store is ready for reads\n * (the in-memory store is always ready)\n */\nfunction ready(): Promise<void> {\n  return readyPromise\n}\n\nexport function setupInMemoryStore(): IDataStore {\n  return {\n    getNode,\n    getTypes,\n    countNodes,\n    ready,\n    iterateNodes,\n    iterateNodesByType,\n    runQuery,\n\n    // deprecated:\n    getNodes,\n    getNodesByType,\n  }\n}\n"],"mappings":";;;;;AACA;;AAEA;;AACA;;AAEA;AACA;AACA;AACA,SAASA,QAAT,GAAwC;EAAA;;EACtC,MAAMC,KAAK,4BAAGC,YAAA,CAAMC,QAAN,GAAiBF,KAApB,yEAA6B,IAAIG,GAAJ,EAAxC;EACA,OAAOC,KAAK,CAACC,IAAN,CAAWL,KAAK,CAACM,MAAN,EAAX,CAAP;AACD;AAED;AACA;AACA;;;AACA,SAASC,cAAT,CAAwBC,IAAxB,EAA0D;EAAA;;EACxD,MAAMR,KAAK,6BAAGC,YAAA,CAAMC,QAAN,GAAiBO,WAAjB,CAA6BC,GAA7B,CAAiCF,IAAjC,CAAH,2EAA6C,IAAIL,GAAJ,EAAxD;EACA,OAAOC,KAAK,CAACC,IAAN,CAAWL,KAAK,CAACM,MAAN,EAAX,CAAP;AACD;;AAED,SAASK,YAAT,GAAqD;EAAA;;EACnD,MAAMX,KAAK,6BAAGC,YAAA,CAAMC,QAAN,GAAiBF,KAApB,2EAA6B,IAAIG,GAAJ,EAAxC;EACA,OAAO,IAAIS,wBAAJ,CAAmBZ,KAAK,CAACM,MAAN,EAAnB,CAAP;AACD;;AAED,SAASO,kBAAT,CAA4BL,IAA5B,EAAuE;EAAA;;EACrE,MAAMR,KAAK,6BAAGC,YAAA,CAAMC,QAAN,GAAiBO,WAAjB,CAA6BC,GAA7B,CAAiCF,IAAjC,CAAH,2EAA6C,IAAIL,GAAJ,EAAxD;EACA,OAAO,IAAIS,wBAAJ,CAAmBZ,KAAK,CAACM,MAAN,EAAnB,CAAP;AACD;;AAED,SAASQ,OAAT,CAAiBC,EAAjB,EAAsD;EACpD,OAAOd,YAAA,CAAMC,QAAN,GAAiBF,KAAjB,CAAuBU,GAAvB,CAA2BK,EAA3B,CAAP;AACD;;AAED,SAASC,QAAT,GAAmC;EACjC;EACA,OAAOZ,KAAK,CAACC,IAAN,CAAWJ,YAAA,CAAMC,QAAN,GAAiBO,WAAjB,CAA6BQ,IAA7B,EAAX,EAAgDC,IAAhD,EAAP;AACD;;AAED,SAASC,UAAT,CAAoBC,QAApB,EAA+C;EAC7C,IAAI,CAACA,QAAL,EAAe;IACb,OAAOnB,YAAA,CAAMC,QAAN,GAAiBF,KAAjB,CAAuBqB,IAA9B;EACD;;EACD,MAAMrB,KAAK,GAAGC,YAAA,CAAMC,QAAN,GAAiBO,WAAjB,CAA6BC,GAA7B,CAAiCU,QAAjC,CAAd;;EACA,OAAOpB,KAAK,GAAGA,KAAK,CAACqB,IAAT,GAAgB,CAA5B;AACD;;AAED,SAASC,QAAT,CAAkBC,IAAlB,EAA8D;EAC5D,OAAOC,OAAO,CAACC,OAAR,CAAgB,IAAAC,qCAAA,EAAsBH,IAAtB,CAAhB,CAAP;AACD;;AAED,MAAMI,YAAY,GAAGH,OAAO,CAACC,OAAR,CAAgBG,SAAhB,CAArB;AAEA;AACA;AACA;AACA;;AACA,SAASC,KAAT,GAAgC;EAC9B,OAAOF,YAAP;AACD;;AAEM,SAASG,kBAAT,GAA0C;EAC/C,OAAO;IACLhB,OADK;IAELE,QAFK;IAGLG,UAHK;IAILU,KAJK;IAKLlB,YALK;IAMLE,kBANK;IAOLS,QAPK;IASL;IACAvB,QAVK;IAWLQ;EAXK,CAAP;AAaD"}