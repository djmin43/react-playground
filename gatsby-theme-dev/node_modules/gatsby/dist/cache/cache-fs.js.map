{"version":3,"file":"cache-fs.js","names":["fs","require","crypto","path","promisify","jsonFileStore","wrapCallback","globalGatsbyCacheLock","Map","showLockTimeoutWarning","exports","create","args","DiskStore","options","ttl","maxsize","Infinity","subdirs","zip","lockFile","wait","pollPeriod","stale","retries","retryWait","existsSync","mkdirSync","prototype","set","key","val","filePath","_getFilePathByKey","data","expireTime","Date","now","dir","dirname","access","constants","W_OK","catch","mkdir","err","code","_lock","write","_unlock","get","read","err2","del","undefined","delete","reset","readdir","stat","unlink","deletePath","fileOrDir","maxDeep","stats","isDirectory","files","i","length","join","isFile","test","Promise","resolve","reject","innerLock","lockTime","reporter","verbose","setTimeout","e","hash","createHash","update","digest","slice"],"sources":["../../src/cache/cache-fs.ts"],"sourcesContent":["// Initial file from https://github.com/rolandstarke/node-cache-manager-fs-hash @ af52d2d\n/* eslint-disable @babel/no-invalid-this, no-useless-catch */\n/* !\nThe MIT License (MIT)\n\nCopyright (c) 2017 Roland Starke\n\nPermission is hereby granted, free of charge, to any person obtaining a copy\nof this software and associated documentation files (the \"Software\"), to deal\nin the Software without restriction, including without limitation the rights\nto use, copy, modify, merge, publish, distribute, sublicense, and/or sell\ncopies of the Software, and to permit persons to whom the Software is\nfurnished to do so, subject to the following conditions:\n\nThe above copyright notice and this permission notice shall be included in all\ncopies or substantial portions of the Software.\n\nTHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\nIMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\nFITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\nAUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\nLIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\nOUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\nSOFTWARE.\n*/\nconst fs = require(`fs`)\nconst crypto = require(`crypto`)\nconst path = require(`path`)\nconst promisify = require(`util`).promisify\nconst jsonFileStore = require(`./json-file-store`)\nconst wrapCallback = require(`./wrap-callback`)\n\nimport reporter from \"gatsby-cli/lib/reporter\"\n\n// Cache read/writes are async. This locking attempts to prevent race conditions.\n// It's not ideal and locks timeout after 10s. It's mostly a port from when this\n// mechanism was using fs-based locks. Doing it in-memory reduces IO pressure and\n// we currently don't support two concurrent builds at the same time anyways.\nconst globalGatsbyCacheLock = new Map()\n\nlet showLockTimeoutWarning = true // Only show this once\n\n/**\n * construction of the disk storage\n * @param {object} [args] options of disk store\n * @param {string} [args.path] path for cached files\n * @param {number} [args.ttl] time to life in seconds\n * @param {boolean} [args.zip] zip content to save diskspace\n * @todo {number} [args.maxsize] max size in bytes on disk\n * @param {boolean} [args.subdirs] create subdirectories\n * @returns {DiskStore}\n */\nexports.create = function (args): typeof DiskStore {\n  return new DiskStore(args && args.options ? args.options : args)\n}\n\nfunction DiskStore(this: any, options): void {\n  options = options || {}\n\n  this.options = {\n    path: options.path || `./cache` /* path for cached files  */,\n    ttl:\n      options.ttl >= 0\n        ? +options.ttl\n        : 60 * 60 /* time before expiring in seconds */,\n    maxsize: options.maxsize || Infinity /* max size in bytes on disk */,\n    subdirs: options.subdirs || false,\n    zip: options.zip || false,\n    lockFile: {\n      // check lock at 0ms 50ms 100ms ... 400ms 1400ms 1450ms... up to 10 seconds, after that just assume the lock is staled\n      wait: 400,\n      pollPeriod: 50,\n      stale: 10 * 1000,\n      retries: 10,\n      retryWait: 600,\n    },\n  }\n\n  // check storage directory for existence (or create it)\n  if (!fs.existsSync(this.options.path)) {\n    fs.mkdirSync(this.options.path)\n  }\n}\n\n/**\n * save an entry in store\n * @param {string} key\n * @param {*} val\n * @param {object} [options]\n * @param {number} options.ttl time to life in seconds\n * @param {function} [cb]\n * @returns {Promise}\n */\nDiskStore.prototype.set = wrapCallback(async function (\n  this: any,\n  key,\n  val,\n  options\n) {\n  key = key + ``\n  const filePath = this._getFilePathByKey(key)\n\n  const ttl = options && options.ttl >= 0 ? +options.ttl : this.options.ttl\n  const data = {\n    expireTime: Date.now() + ttl * 1000,\n    key: key,\n    val: val,\n  }\n\n  if (this.options.subdirs) {\n    // check if subdir exists or create it\n    const dir = path.dirname(filePath)\n    await promisify(fs.access)(dir, fs.constants.W_OK).catch(function () {\n      return promisify(fs.mkdir)(dir).catch(err => {\n        if (err.code !== `EEXIST`) throw err\n      })\n    })\n  }\n\n  try {\n    await this._lock(filePath)\n    await jsonFileStore.write(filePath, data, this.options)\n  } catch (err) {\n    throw err\n  } finally {\n    await this._unlock(filePath)\n  }\n})\n\n/**\n * get an entry from store\n * @param {string} key\n * @param {function} [cb]\n * @returns {Promise}\n */\nDiskStore.prototype.get = wrapCallback(async function (this: any, key) {\n  key = key + ``\n  const filePath = this._getFilePathByKey(key)\n\n  try {\n    const data = await jsonFileStore\n      .read(filePath, this.options)\n      .catch(async err => {\n        if (err.code === `ENOENT`) {\n          throw err\n        }\n        // maybe the file is currently written to, lets lock it and read again\n        try {\n          await this._lock(filePath)\n          return await jsonFileStore.read(filePath, this.options)\n        } catch (err2) {\n          throw err2\n        } finally {\n          await this._unlock(filePath)\n        }\n      })\n    if (data.expireTime <= Date.now()) {\n      // cache expired\n      this.del(key).catch(() => 0 /* ignore */)\n      return undefined\n    }\n    if (data.key !== key) {\n      // hash collision\n      return undefined\n    }\n    return data.val\n  } catch (err) {\n    // file does not exist lets return a cache miss\n    if (err.code === `ENOENT`) {\n      return undefined\n    } else {\n      throw err\n    }\n  }\n})\n\n/**\n * delete entry from cache\n */\nDiskStore.prototype.del = wrapCallback(async function (this: any, key) {\n  const filePath = this._getFilePathByKey(key)\n  try {\n    if (this.options.subdirs) {\n      // check if the folder exists to fail faster\n      const dir = path.dirname(filePath)\n      await promisify(fs.access)(dir, fs.constants.W_OK)\n    }\n\n    await this._lock(filePath)\n    await jsonFileStore.delete(filePath, this.options)\n  } catch (err) {\n    // ignore deleting non existing keys\n    if (err.code !== `ENOENT`) {\n      throw err\n    }\n  } finally {\n    await this._unlock(filePath)\n  }\n})\n\n/**\n * cleanup cache on disk -> delete all files from the cache\n */\nDiskStore.prototype.reset = wrapCallback(async function (\n  this: any\n): Promise<void> {\n  const readdir = promisify(fs.readdir)\n  const stat = promisify(fs.stat)\n  const unlink = promisify(fs.unlink)\n\n  return await deletePath(this.options.path, 2)\n\n  async function deletePath(fileOrDir, maxDeep): Promise<void> {\n    if (maxDeep < 0) {\n      return\n    }\n    const stats = await stat(fileOrDir)\n    if (stats.isDirectory()) {\n      const files = await readdir(fileOrDir)\n      for (let i = 0; i < files.length; i++) {\n        await deletePath(path.join(fileOrDir, files[i]), maxDeep - 1)\n      }\n    } else if (\n      stats.isFile() &&\n      /[/\\\\]diskstore-[0-9a-fA-F/\\\\]+(\\.json|-\\d\\.bin)/.test(fileOrDir)\n    ) {\n      // delete the file if it is a diskstore file\n      await unlink(fileOrDir)\n    }\n  }\n})\n\n/**\n * locks a file so other forks that want to use the same file have to wait\n * @param {string} filePath\n * @returns {Promise}\n * @private\n */\nDiskStore.prototype._lock = function _lock(filePath): Promise<void> {\n  return new Promise((resolve, reject) => innerLock(resolve, reject, filePath))\n}\n\nfunction innerLock(resolve, reject, filePath): void {\n  try {\n    let lockTime = globalGatsbyCacheLock.get(filePath) ?? 0\n    if (lockTime > 0 && Date.now() - lockTime > 10 * 1000) {\n      if (showLockTimeoutWarning) {\n        showLockTimeoutWarning = false\n        reporter.verbose(\n          `Warning: lock file older than 10s, ignoring it... There is a possibility this leads to caching problems later. This warning will only be shown once.`\n        )\n      }\n      lockTime = 0\n      globalGatsbyCacheLock.delete(filePath)\n    }\n\n    if (lockTime > 0) {\n      setTimeout(() => {\n        innerLock(resolve, reject, filePath)\n      }, 50)\n    } else {\n      // set sync\n      globalGatsbyCacheLock.set(filePath, Date.now())\n      resolve()\n    }\n  } catch (e) {\n    reject(e)\n  }\n}\n\n/**\n * unlocks a file path\n * @type {Function}\n * @param {string} filePath\n * @returns {void}\n * @private\n */\nDiskStore.prototype._unlock = function _unlock(filePath): void {\n  globalGatsbyCacheLock.delete(filePath)\n}\n\n/**\n * returns the location where the value should be stored\n * @param {string} key\n * @returns {string}\n * @private\n */\nDiskStore.prototype._getFilePathByKey = function (key): string {\n  const hash = crypto\n    .createHash(`md5`)\n    .update(key + ``)\n    .digest(`hex`)\n  if (this.options.subdirs) {\n    // create subdirs with the first 3 chars of the hash\n    return path.join(\n      this.options.path,\n      `diskstore-` + hash.slice(0, 3),\n      hash.slice(3)\n    )\n  } else {\n    return path.join(this.options.path, `diskstore-` + hash)\n  }\n}\n"],"mappings":"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"}