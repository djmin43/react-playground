{"version":3,"file":"node-interface.js","names":["NodeInterfaceFields","getOrCreateNodeInterface","schemaComposer","internalTC","getOrCreateOTC","tc","addFields","content","contentDigest","description","fieldOwners","ignoreType","mediaType","owner","type","getInputTypeComposer","nodeInterfaceTC","getOrCreateIFTC","setDescription","id","parent","resolve","source","_args","context","path","nodeModel","getNodeById","extensions","searchable","SEARCHABLE_ENUM","SEARCHABLE","sortable","SORTABLE_ENUM","SORTABLE","needsResolve","children","getNodesByIds","ids","internal","getTypeNonNull","nodeInputTC","extendField","addNodeInterfaceFields","typeComposer","getFields","setResolveType","node","addSchemaMustHaveType","addNodeInterface","addInterface","getNodeInterface"],"sources":["../../../src/schema/types/node-interface.ts"],"sourcesContent":["import { SORTABLE_ENUM } from \"./sort\"\nimport { SEARCHABLE_ENUM } from \"./filter\"\nimport {\n  SchemaComposer,\n  InterfaceTypeComposer,\n  ObjectTypeComposer,\n} from \"graphql-compose\"\nimport { IGatsbyResolverContext } from \"../type-definitions\"\nimport { Node } from \"../../..\"\n\nexport const NodeInterfaceFields = [`id`, `parent`, `children`, `internal`]\n\nconst getOrCreateNodeInterface = <TSource, TArgs>(\n  schemaComposer: SchemaComposer<IGatsbyResolverContext<TSource, TArgs>>\n): InterfaceTypeComposer => {\n  // TODO: why is `mediaType` on Internal? Applies only to File!?\n  // `fieldOwners` is an object\n  // Should we drop ignoreType?\n  const internalTC = schemaComposer.getOrCreateOTC(`Internal`, tc => {\n    tc.addFields({\n      content: `String`,\n      contentDigest: `String!`,\n      description: `String`,\n      fieldOwners: [`String`],\n      ignoreType: `Boolean`,\n      mediaType: `String`,\n      owner: `String!`,\n      type: `String!`,\n    })\n    // TODO: Can be removed with graphql-compose 5.11\n    tc.getInputTypeComposer()\n  })\n\n  const nodeInterfaceTC = schemaComposer.getOrCreateIFTC(`Node`, tc => {\n    tc.setDescription(`Node Interface`)\n    tc.addFields({\n      id: `ID!`,\n      parent: {\n        type: `Node`,\n        resolve: (source, _args, context): Node | null => {\n          const { path } = context\n          return context.nodeModel.getNodeById({ id: source.parent }, { path })\n        },\n        extensions: {\n          searchable: SEARCHABLE_ENUM.SEARCHABLE,\n          sortable: SORTABLE_ENUM.SORTABLE,\n          needsResolve: true,\n        },\n      },\n      children: {\n        type: `[Node!]!`,\n        resolve: (source, _args, context): Array<Node> => {\n          const { path } = context\n          return context.nodeModel.getNodesByIds(\n            { ids: source.children },\n            { path }\n          )\n        },\n        extensions: {\n          searchable: SEARCHABLE_ENUM.SEARCHABLE,\n          sortable: SORTABLE_ENUM.SORTABLE,\n          needsResolve: true,\n        },\n      },\n      internal: internalTC.getTypeNonNull(),\n    })\n\n    const nodeInputTC = tc.getInputTypeComposer()\n    nodeInputTC.extendField(`id`, { type: `String` })\n  })\n\n  return nodeInterfaceTC\n}\n\nexport const addNodeInterfaceFields = <TSource = any, TArgs = any>({\n  schemaComposer,\n  typeComposer,\n}: {\n  schemaComposer: SchemaComposer<IGatsbyResolverContext<TSource, TArgs>>\n  typeComposer: ObjectTypeComposer\n}): void => {\n  const nodeInterfaceTC = getOrCreateNodeInterface(schemaComposer)\n  typeComposer.addFields(nodeInterfaceTC.getFields())\n  nodeInterfaceTC.setResolveType(node => node.internal.type)\n  schemaComposer.addSchemaMustHaveType(typeComposer)\n}\n\nexport const addNodeInterface = <TSource = any, TArgs = any>({\n  schemaComposer,\n  typeComposer,\n}: {\n  schemaComposer: SchemaComposer<IGatsbyResolverContext<TSource, TArgs>>\n  typeComposer: ObjectTypeComposer\n}): void => {\n  const nodeInterfaceTC = getOrCreateNodeInterface(schemaComposer)\n  typeComposer.addInterface(nodeInterfaceTC)\n  addNodeInterfaceFields({ schemaComposer, typeComposer })\n}\n\nexport const getNodeInterface = <TSource = any, TContext = any, TArgs = any>({\n  schemaComposer,\n}: {\n  schemaComposer: SchemaComposer<IGatsbyResolverContext<TSource, TArgs>>\n}): InterfaceTypeComposer<TSource, TContext> =>\n  getOrCreateNodeInterface(schemaComposer)\n"],"mappings":"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"}