{"version":3,"file":"pagination.js","names":["getPageInfo","schemaComposer","getOrCreateOTC","tc","addFields","currentPage","hasPreviousPage","hasNextPage","itemCount","pageCount","perPage","totalCount","getEdge","typeComposer","typeName","getTypeName","addDerivedType","derivedTypeName","next","node","getTypeNonNull","previous","getGroup","fields","field","fieldValue","createPagination","getPagination","inputTypeComposer","getInputTypeComposer","fieldsEnumTC","getFieldsEnum","paginationTypeComposer","aggregationFields","distinct","type","args","resolve","createDistinctResolver","max","createMaxResolver","min","createMinResolver","sum","createSumResolver","group","skip","limit","createGroupResolver","edges","nodes","pageInfo","makeFieldNonNull"],"sources":["../../../src/schema/types/pagination.ts"],"sourcesContent":["import {\n  SchemaComposer,\n  ObjectTypeComposer,\n  InputTypeComposer,\n  InterfaceTypeComposer,\n  ObjectTypeComposerFieldConfigMapDefinition,\n} from \"graphql-compose\"\nimport { getFieldsEnum } from \"./sort\"\nimport { addDerivedType } from \"./derived-types\"\nimport {\n  createDistinctResolver,\n  createGroupResolver,\n  createMaxResolver,\n  createMinResolver,\n  createSumResolver,\n} from \"../resolvers\"\n\nexport const getPageInfo = <TContext = any>({\n  schemaComposer,\n}: {\n  schemaComposer: SchemaComposer<TContext>\n}): ObjectTypeComposer =>\n  schemaComposer.getOrCreateOTC(`PageInfo`, tc => {\n    tc.addFields({\n      currentPage: `Int!`,\n      hasPreviousPage: `Boolean!`,\n      hasNextPage: `Boolean!`,\n      itemCount: `Int!`,\n      pageCount: `Int!`,\n      perPage: `Int`,\n      totalCount: `Int!`,\n    })\n  })\n\nexport const getEdge = <TContext = any>({\n  schemaComposer,\n  typeComposer,\n}: {\n  schemaComposer: SchemaComposer<TContext>\n  typeComposer: ObjectTypeComposer | InterfaceTypeComposer\n}): ObjectTypeComposer => {\n  const typeName = `${typeComposer.getTypeName()}Edge`\n  addDerivedType({ typeComposer, derivedTypeName: typeName })\n  return schemaComposer.getOrCreateOTC(typeName, tc => {\n    tc.addFields({\n      next: typeComposer,\n      node: typeComposer.getTypeNonNull(),\n      previous: typeComposer,\n    })\n  })\n}\n\nexport const getGroup = <TContext = any>({\n  schemaComposer,\n  typeComposer,\n}: {\n  schemaComposer: SchemaComposer<TContext>\n  typeComposer: ObjectTypeComposer | InterfaceTypeComposer\n}): ObjectTypeComposer => {\n  const typeName = `${typeComposer.getTypeName()}GroupConnection`\n  const fields = {\n    field: `String!`,\n    fieldValue: `String`,\n  }\n  return createPagination({ schemaComposer, typeComposer, typeName, fields })\n}\n\nexport const getPagination = <TContext = any>({\n  schemaComposer,\n  typeComposer,\n}: {\n  schemaComposer: SchemaComposer<TContext>\n  typeComposer: ObjectTypeComposer | InterfaceTypeComposer\n}): ObjectTypeComposer => {\n  const typeName = `${typeComposer.getTypeName()}Connection`\n  return createPagination({ schemaComposer, typeComposer, typeName })\n}\n\nfunction createPagination<TSource = any, TContext = any>({\n  schemaComposer,\n  typeComposer,\n  fields,\n  typeName,\n}: {\n  schemaComposer: SchemaComposer<TContext>\n  typeComposer: ObjectTypeComposer | InterfaceTypeComposer\n  typeName: string\n  fields?: ObjectTypeComposerFieldConfigMapDefinition<TSource, TContext>\n}): ObjectTypeComposer {\n  const inputTypeComposer: InputTypeComposer =\n    typeComposer.getInputTypeComposer()\n  const fieldsEnumTC = getFieldsEnum({\n    schemaComposer,\n    typeComposer,\n    inputTypeComposer,\n  })\n  const paginationTypeComposer: ObjectTypeComposer =\n    schemaComposer.getOrCreateOTC(typeName, tc => {\n      // getGroup() will create a recursive call to pagination,\n      // so only add it and other aggregate functions on onCreate.\n      // Cast into their own category to avoid Typescript conflicts.\n      const aggregationFields: { [key: string]: any } = {\n        distinct: {\n          type: [`String!`],\n          args: {\n            field: fieldsEnumTC.getTypeNonNull(),\n          },\n          resolve: createDistinctResolver(typeComposer.getTypeName()),\n        },\n        max: {\n          type: `Float`,\n          args: {\n            field: fieldsEnumTC.getTypeNonNull(),\n          },\n          resolve: createMaxResolver(typeComposer.getTypeName()),\n        },\n        min: {\n          type: `Float`,\n          args: {\n            field: fieldsEnumTC.getTypeNonNull(),\n          },\n          resolve: createMinResolver(typeComposer.getTypeName()),\n        },\n        sum: {\n          type: `Float`,\n          args: {\n            field: fieldsEnumTC.getTypeNonNull(),\n          },\n          resolve: createSumResolver(typeComposer.getTypeName()),\n        },\n        group: {\n          type: [getGroup({ schemaComposer, typeComposer }).getTypeNonNull()],\n          args: {\n            skip: `Int`,\n            limit: `Int`,\n            field: fieldsEnumTC.getTypeNonNull(),\n          },\n          resolve: createGroupResolver(typeComposer.getTypeName()),\n        },\n      }\n\n      tc.addFields({\n        totalCount: `Int!`,\n        edges: [getEdge({ schemaComposer, typeComposer }).getTypeNonNull()],\n        nodes: [typeComposer.getTypeNonNull()],\n        pageInfo: getPageInfo({ schemaComposer }).getTypeNonNull(),\n        ...aggregationFields,\n        ...fields,\n      })\n    })\n  paginationTypeComposer.makeFieldNonNull(`edges`)\n  paginationTypeComposer.makeFieldNonNull(`nodes`)\n  paginationTypeComposer.makeFieldNonNull(`distinct`)\n  paginationTypeComposer.makeFieldNonNull(`group`)\n  addDerivedType({ typeComposer, derivedTypeName: typeName })\n  return paginationTypeComposer\n}\n"],"mappings":";;;;;AAOA;;AACA;;AACA;;AAQO,MAAMA,WAAW,GAAG,CAAiB;EAC1CC;AAD0C,CAAjB,KAKzBA,cAAc,CAACC,cAAf,CAA+B,UAA/B,EAA0CC,EAAE,IAAI;EAC9CA,EAAE,CAACC,SAAH,CAAa;IACXC,WAAW,EAAG,MADH;IAEXC,eAAe,EAAG,UAFP;IAGXC,WAAW,EAAG,UAHH;IAIXC,SAAS,EAAG,MAJD;IAKXC,SAAS,EAAG,MALD;IAMXC,OAAO,EAAG,KANC;IAOXC,UAAU,EAAG;EAPF,CAAb;AASD,CAVD,CALK;;;;AAiBA,MAAMC,OAAO,GAAG,CAAiB;EACtCX,cADsC;EAEtCY;AAFsC,CAAjB,KAMG;EACxB,MAAMC,QAAQ,GAAI,GAAED,YAAY,CAACE,WAAb,EAA2B,MAA/C;EACA,IAAAC,4BAAA,EAAe;IAAEH,YAAF;IAAgBI,eAAe,EAAEH;EAAjC,CAAf;EACA,OAAOb,cAAc,CAACC,cAAf,CAA8BY,QAA9B,EAAwCX,EAAE,IAAI;IACnDA,EAAE,CAACC,SAAH,CAAa;MACXc,IAAI,EAAEL,YADK;MAEXM,IAAI,EAAEN,YAAY,CAACO,cAAb,EAFK;MAGXC,QAAQ,EAAER;IAHC,CAAb;EAKD,CANM,CAAP;AAOD,CAhBM;;;;AAkBA,MAAMS,QAAQ,GAAG,CAAiB;EACvCrB,cADuC;EAEvCY;AAFuC,CAAjB,KAME;EACxB,MAAMC,QAAQ,GAAI,GAAED,YAAY,CAACE,WAAb,EAA2B,iBAA/C;EACA,MAAMQ,MAAM,GAAG;IACbC,KAAK,EAAG,SADK;IAEbC,UAAU,EAAG;EAFA,CAAf;EAIA,OAAOC,gBAAgB,CAAC;IAAEzB,cAAF;IAAkBY,YAAlB;IAAgCC,QAAhC;IAA0CS;EAA1C,CAAD,CAAvB;AACD,CAbM;;;;AAeA,MAAMI,aAAa,GAAG,CAAiB;EAC5C1B,cAD4C;EAE5CY;AAF4C,CAAjB,KAMH;EACxB,MAAMC,QAAQ,GAAI,GAAED,YAAY,CAACE,WAAb,EAA2B,YAA/C;EACA,OAAOW,gBAAgB,CAAC;IAAEzB,cAAF;IAAkBY,YAAlB;IAAgCC;EAAhC,CAAD,CAAvB;AACD,CATM;;;;AAWP,SAASY,gBAAT,CAAyD;EACvDzB,cADuD;EAEvDY,YAFuD;EAGvDU,MAHuD;EAIvDT;AAJuD,CAAzD,EAUuB;EACrB,MAAMc,iBAAoC,GACxCf,YAAY,CAACgB,oBAAb,EADF;EAEA,MAAMC,YAAY,GAAG,IAAAC,mBAAA,EAAc;IACjC9B,cADiC;IAEjCY,YAFiC;IAGjCe;EAHiC,CAAd,CAArB;EAKA,MAAMI,sBAA0C,GAC9C/B,cAAc,CAACC,cAAf,CAA8BY,QAA9B,EAAwCX,EAAE,IAAI;IAC5C;IACA;IACA;IACA,MAAM8B,iBAAyC,GAAG;MAChDC,QAAQ,EAAE;QACRC,IAAI,EAAE,CAAE,SAAF,CADE;QAERC,IAAI,EAAE;UACJZ,KAAK,EAAEM,YAAY,CAACV,cAAb;QADH,CAFE;QAKRiB,OAAO,EAAE,IAAAC,iCAAA,EAAuBzB,YAAY,CAACE,WAAb,EAAvB;MALD,CADsC;MAQhDwB,GAAG,EAAE;QACHJ,IAAI,EAAG,OADJ;QAEHC,IAAI,EAAE;UACJZ,KAAK,EAAEM,YAAY,CAACV,cAAb;QADH,CAFH;QAKHiB,OAAO,EAAE,IAAAG,4BAAA,EAAkB3B,YAAY,CAACE,WAAb,EAAlB;MALN,CAR2C;MAehD0B,GAAG,EAAE;QACHN,IAAI,EAAG,OADJ;QAEHC,IAAI,EAAE;UACJZ,KAAK,EAAEM,YAAY,CAACV,cAAb;QADH,CAFH;QAKHiB,OAAO,EAAE,IAAAK,4BAAA,EAAkB7B,YAAY,CAACE,WAAb,EAAlB;MALN,CAf2C;MAsBhD4B,GAAG,EAAE;QACHR,IAAI,EAAG,OADJ;QAEHC,IAAI,EAAE;UACJZ,KAAK,EAAEM,YAAY,CAACV,cAAb;QADH,CAFH;QAKHiB,OAAO,EAAE,IAAAO,4BAAA,EAAkB/B,YAAY,CAACE,WAAb,EAAlB;MALN,CAtB2C;MA6BhD8B,KAAK,EAAE;QACLV,IAAI,EAAE,CAACb,QAAQ,CAAC;UAAErB,cAAF;UAAkBY;QAAlB,CAAD,CAAR,CAA2CO,cAA3C,EAAD,CADD;QAELgB,IAAI,EAAE;UACJU,IAAI,EAAG,KADH;UAEJC,KAAK,EAAG,KAFJ;UAGJvB,KAAK,EAAEM,YAAY,CAACV,cAAb;QAHH,CAFD;QAOLiB,OAAO,EAAE,IAAAW,8BAAA,EAAoBnC,YAAY,CAACE,WAAb,EAApB;MAPJ;IA7ByC,CAAlD;IAwCAZ,EAAE,CAACC,SAAH,CAAa;MACXO,UAAU,EAAG,MADF;MAEXsC,KAAK,EAAE,CAACrC,OAAO,CAAC;QAAEX,cAAF;QAAkBY;MAAlB,CAAD,CAAP,CAA0CO,cAA1C,EAAD,CAFI;MAGX8B,KAAK,EAAE,CAACrC,YAAY,CAACO,cAAb,EAAD,CAHI;MAIX+B,QAAQ,EAAEnD,WAAW,CAAC;QAAEC;MAAF,CAAD,CAAX,CAAgCmB,cAAhC,EAJC;MAKX,GAAGa,iBALQ;MAMX,GAAGV;IANQ,CAAb;EAQD,CApDD,CADF;EAsDAS,sBAAsB,CAACoB,gBAAvB,CAAyC,OAAzC;EACApB,sBAAsB,CAACoB,gBAAvB,CAAyC,OAAzC;EACApB,sBAAsB,CAACoB,gBAAvB,CAAyC,UAAzC;EACApB,sBAAsB,CAACoB,gBAAvB,CAAyC,OAAzC;EACA,IAAApC,4BAAA,EAAe;IAAEH,YAAF;IAAgBI,eAAe,EAAEH;EAAjC,CAAf;EACA,OAAOkB,sBAAP;AACD"}