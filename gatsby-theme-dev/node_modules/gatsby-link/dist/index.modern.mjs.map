{"version":3,"file":"index.modern.mjs","sources":["../src/parse-path.js","../src/is-local-link.js","../src/prefix-helpers.js","../src/rewrite-link-path.js","../src/index.js"],"sourcesContent":["export function parsePath(path) {\n  let pathname = path || `/`\n  let search = ``\n  let hash = ``\n\n  const hashIndex = pathname.indexOf(`#`)\n  if (hashIndex !== -1) {\n    hash = pathname.slice(hashIndex)\n    pathname = pathname.slice(0, hashIndex)\n  }\n\n  const searchIndex = pathname.indexOf(`?`)\n  if (searchIndex !== -1) {\n    search = pathname.slice(searchIndex)\n    pathname = pathname.slice(0, searchIndex)\n  }\n\n  return {\n    pathname: pathname,\n    search: search === `?` ? `` : search,\n    hash: hash === `#` ? `` : hash,\n  }\n}\n","// Copied from https://github.com/sindresorhus/is-absolute-url/blob/3ab19cc2e599a03ea691bcb8a4c09fa3ebb5da4f/index.js\nconst ABSOLUTE_URL_REGEX = /^[a-zA-Z][a-zA-Z\\d+\\-.]*?:/\nconst isAbsolute = path => ABSOLUTE_URL_REGEX.test(path)\n\nexport const isLocalLink = path => {\n  if (typeof path !== `string`) {\n    return undefined\n    // TODO(v5): Re-Add TypeError\n    // throw new TypeError(`Expected a \\`string\\`, got \\`${typeof path}\\``)\n  }\n\n  return !isAbsolute(path)\n}\n","import { isLocalLink } from \"./is-local-link\"\n\nexport const getGlobalBasePrefix = () =>\n  process.env.NODE_ENV !== `production`\n    ? typeof __BASE_PATH__ !== `undefined`\n      ? __BASE_PATH__\n      : undefined\n    : __BASE_PATH__\n\n// These global values are wrapped in typeof clauses to ensure the values exist.\n// This is especially problematic in unit testing of this component.\nexport const getGlobalPathPrefix = () =>\n  process.env.NODE_ENV !== `production`\n    ? typeof __PATH_PREFIX__ !== `undefined`\n      ? __PATH_PREFIX__\n      : undefined\n    : __PATH_PREFIX__\n\nexport function withPrefix(path, prefix = getGlobalBasePrefix()) {\n  if (!isLocalLink(path)) {\n    return path\n  }\n\n  if (path.startsWith(`./`) || path.startsWith(`../`)) {\n    return path\n  }\n  const base = prefix ?? getGlobalPathPrefix() ?? `/`\n\n  return `${base?.endsWith(`/`) ? base.slice(0, -1) : base}${\n    path.startsWith(`/`) ? path : `/${path}`\n  }`\n}\n","import { resolve } from \"@gatsbyjs/reach-router\"\n// Specific import to treeshake Node.js stuff\nimport { applyTrailingSlashOption } from \"gatsby-page-utils/apply-trailing-slash-option\"\nimport { parsePath } from \"./parse-path\"\nimport { isLocalLink } from \"./is-local-link\"\nimport { withPrefix } from \"./prefix-helpers\"\n\nconst isAbsolutePath = path => path?.startsWith(`/`)\n\nconst getGlobalTrailingSlash = () =>\n  typeof __TRAILING_SLASH__ !== `undefined` ? __TRAILING_SLASH__ : undefined\n\nfunction absolutify(path, current) {\n  // If it's already absolute, return as-is\n  if (isAbsolutePath(path)) {\n    return path\n  }\n\n  const option = getGlobalTrailingSlash()\n  const absolutePath = resolve(path, current)\n\n  if (option === `always` || option === `never`) {\n    return applyTrailingSlashOption(absolutePath, option)\n  }\n\n  return absolutePath\n}\n\nexport const rewriteLinkPath = (path, relativeTo) => {\n  if (typeof path === `number`) {\n    return path\n  }\n  if (!isLocalLink(path)) {\n    return path\n  }\n\n  const { pathname, search, hash } = parsePath(path)\n  const option = getGlobalTrailingSlash()\n  let adjustedPath = path\n\n  if (option === `always` || option === `never`) {\n    const output = applyTrailingSlashOption(pathname, option)\n    adjustedPath = `${output}${search}${hash}`\n  }\n\n  return isAbsolutePath(adjustedPath)\n    ? withPrefix(adjustedPath)\n    : absolutify(adjustedPath, relativeTo)\n}\n","import PropTypes from \"prop-types\"\nimport React from \"react\"\nimport { Link, Location } from \"@gatsbyjs/reach-router\"\nimport { parsePath } from \"./parse-path\"\nimport { isLocalLink } from \"./is-local-link\"\nimport { rewriteLinkPath } from \"./rewrite-link-path\"\nimport { withPrefix, getGlobalPathPrefix } from \"./prefix-helpers\"\n\nexport { parsePath, withPrefix }\n\nexport function withAssetPrefix(path) {\n  return withPrefix(path, getGlobalPathPrefix())\n}\n\nconst NavLinkPropTypes = {\n  activeClassName: PropTypes.string,\n  activeStyle: PropTypes.object,\n  partiallyActive: PropTypes.bool,\n}\n\n// Set up IntersectionObserver\nconst createIntersectionObserver = (el, cb) => {\n  const io = new window.IntersectionObserver(entries => {\n    entries.forEach(entry => {\n      if (el === entry.target) {\n        // Check if element is within viewport, remove listener, destroy observer, and run link callback.\n        // MSEdge doesn't currently support isIntersecting, so also test for  an intersectionRatio > 0\n        cb(entry.isIntersecting || entry.intersectionRatio > 0)\n      }\n    })\n  })\n\n  // Add element to the observer\n  io.observe(el)\n\n  return { instance: io, el }\n}\n\nfunction GatsbyLinkLocationWrapper(props) {\n  return (\n    <Location>\n      {({ location }) => <GatsbyLink {...props} _location={location} />}\n    </Location>\n  )\n}\n\nclass GatsbyLink extends React.Component {\n  constructor(props) {\n    super(props)\n    // Default to no support for IntersectionObserver\n    let IOSupported = false\n    if (typeof window !== `undefined` && window.IntersectionObserver) {\n      IOSupported = true\n    }\n\n    this.state = {\n      IOSupported,\n    }\n    this.abortPrefetch = null\n    this.handleRef = this.handleRef.bind(this)\n  }\n\n  _prefetch() {\n    let currentPath = window.location.pathname + window.location.search\n\n    // reach router should have the correct state\n    if (this.props._location && this.props._location.pathname) {\n      currentPath = this.props._location.pathname + this.props._location.search\n    }\n\n    const rewrittenPath = rewriteLinkPath(this.props.to, currentPath)\n    const parsed = parsePath(rewrittenPath)\n\n    const newPathName = parsed.pathname + parsed.search\n\n    // Prefetch is used to speed up next navigations. When you use it on the current navigation,\n    // there could be a race-condition where Chrome uses the stale data instead of waiting for the network to complete\n    if (currentPath !== newPathName) {\n      return ___loader.enqueue(newPathName)\n    }\n\n    return undefined\n  }\n\n  componentWillUnmount() {\n    if (!this.io) {\n      return\n    }\n    const { instance, el } = this.io\n\n    if (this.abortPrefetch) {\n      this.abortPrefetch.abort()\n    }\n\n    instance.unobserve(el)\n    instance.disconnect()\n  }\n\n  handleRef(ref) {\n    if (\n      this.props.innerRef &&\n      Object.prototype.hasOwnProperty.call(this.props.innerRef, `current`)\n    ) {\n      this.props.innerRef.current = ref\n    } else if (this.props.innerRef) {\n      this.props.innerRef(ref)\n    }\n\n    if (this.state.IOSupported && ref) {\n      // If IO supported and element reference found, setup Observer functionality\n      this.io = createIntersectionObserver(ref, inViewPort => {\n        if (inViewPort) {\n          this.abortPrefetch = this._prefetch()\n        } else {\n          if (this.abortPrefetch) {\n            this.abortPrefetch.abort()\n          }\n        }\n      })\n    }\n  }\n\n  defaultGetProps = ({ isPartiallyCurrent, isCurrent }) => {\n    if (this.props.partiallyActive ? isPartiallyCurrent : isCurrent) {\n      return {\n        className: [this.props.className, this.props.activeClassName]\n          .filter(Boolean)\n          .join(` `),\n        style: { ...this.props.style, ...this.props.activeStyle },\n      }\n    }\n    return null\n  }\n\n  render() {\n    const {\n      to,\n      getProps = this.defaultGetProps,\n      onClick,\n      onMouseEnter,\n      /* eslint-disable no-unused-vars */\n      activeClassName: $activeClassName,\n      activeStyle: $activeStyle,\n      innerRef: $innerRef,\n      partiallyActive,\n      state,\n      replace,\n      _location,\n      /* eslint-enable no-unused-vars */\n      ...rest\n    } = this.props\n\n    if (process.env.NODE_ENV !== `production` && !isLocalLink(to)) {\n      console.warn(\n        `External link ${to} was detected in a Link component. Use the Link component only for internal links. See: https://gatsby.dev/internal-links`\n      )\n    }\n\n    const prefixedTo = rewriteLinkPath(to, _location.pathname)\n    if (!isLocalLink(prefixedTo)) {\n      return <a href={prefixedTo} {...rest} />\n    }\n\n    return (\n      <Link\n        to={prefixedTo}\n        state={state}\n        getProps={getProps}\n        innerRef={this.handleRef}\n        onMouseEnter={e => {\n          if (onMouseEnter) {\n            onMouseEnter(e)\n          }\n          const parsed = parsePath(prefixedTo)\n          ___loader.hovering(parsed.pathname + parsed.search)\n        }}\n        onClick={e => {\n          if (onClick) {\n            onClick(e)\n          }\n\n          if (\n            e.button === 0 && // ignore right clicks\n            !this.props.target && // let browser handle \"target=_blank\"\n            !e.defaultPrevented && // onClick prevented default\n            !e.metaKey && // ignore clicks with modifier keys...\n            !e.altKey &&\n            !e.ctrlKey &&\n            !e.shiftKey\n          ) {\n            e.preventDefault()\n\n            let shouldReplace = replace\n            const isCurrent = encodeURI(prefixedTo) === _location.pathname\n\n            if (typeof replace !== `boolean` && isCurrent) {\n              shouldReplace = true\n            }\n            // Make sure the necessary scripts and data are\n            // loaded before continuing.\n            window.___navigate(prefixedTo, {\n              state,\n              replace: shouldReplace,\n            })\n          }\n\n          return true\n        }}\n        {...rest}\n      />\n    )\n  }\n}\n\nGatsbyLink.propTypes = {\n  ...NavLinkPropTypes,\n  onClick: PropTypes.func,\n  to: PropTypes.string.isRequired,\n  replace: PropTypes.bool,\n  state: PropTypes.object,\n}\n\nexport default React.forwardRef((props, ref) => (\n  <GatsbyLinkLocationWrapper innerRef={ref} {...props} />\n))\n\nexport const navigate = (to, options) => {\n  window.___navigate(rewriteLinkPath(to, window.location.pathname), options)\n}\n"],"names":["path","pathname","indexOf","hashIndex","hash","slice","searchIndex","search","ABSOLUTE_URL_REGEX","test","isAbsolute","process","env","NODE_ENV","__PATH_PREFIX__","undefined","prefix","__BASE_PATH__","getGlobalBasePrefix","isLocalLink","startsWith","getGlobalPathPrefix","base","endsWith","__TRAILING_SLASH__","relativeTo","parsePath","getGlobalTrailingSlash","option","adjustedPath","applyTrailingSlashOption","withPrefix","current","isAbsolutePath","resolve","absolutePath","absolutify","activeClassName","PropTypes","string","activeStyle","object","partiallyActive","bool","props","React","Location","location","GatsbyLink","_location","Component","constructor","super","this","defaultGetProps","isPartiallyCurrent","isCurrent","className","filter","Boolean","join","style","window","IntersectionObserver","IOSupported","state","abortPrefetch","handleRef","bind","_prefetch","currentPath","rewriteLinkPath","to","parsed","newPathName","enqueue","componentWillUnmount","io","instance","el","abort","unobserve","disconnect","ref","innerRef","Object","prototype","hasOwnProperty","call","cb","entries","forEach","entry","target","isIntersecting","intersectionRatio","observe","createIntersectionObserver","inViewPort","render","getProps","onClick","onMouseEnter","replace","rest","console","warn","prefixedTo","Link","e","___loader","hovering","button","defaultPrevented","metaKey","altKey","ctrlKey","shiftKey","preventDefault","encodeURI","shouldReplace","___navigate","href","propTypes","NavLinkPropTypes","func","isRequired","forwardRef","GatsbyLinkLocationWrapper","navigate","options"],"mappings":"4aAA0BA,GACxB,MAAeA,GAAS,MACV,KACF,GAEZ,QAAkBC,EAASC,QAAS,MACjB,IAAfC,IACFC,EAAOH,EAASI,MAAMF,GACtBF,EAAWA,EAASI,MAAM,EAAGF,IAG/B,QAAoBF,EAASC,QAAS,KAMtC,OALqB,IAAjBI,IACFC,EAASN,EAASI,MAAMC,GACxBL,EAAWA,EAASI,MAAM,EAAGC,IAGxB,CACLL,SAAUA,EACVM,OAAoB,MAAZA,EAAkB,GAAIA,EAC9BH,KAAgB,MAAVA,EAAgB,GAAIA,GCnB9B,QAA2B,+BAGAJ,IACzB,GAAqB,mBAMrB,OATiBA,CAAAA,GAAQQ,EAAmBC,KAAKT,GASzCU,CAAWV,MCAc,IACP,eAA1BW,QAAQC,IAAIC,SACoB,oCAC1BC,qBACAC,EACFD,2BAEqBd,EAAMgB,EAhBE,KACP,eAA1BL,QAAQC,IAAIC,SACkB,kCACxBI,mBACAF,EACFE,cAWoCC,UACxC,IAAKC,EAAYnB,GACf,SAGF,GAAIA,EAAKoB,WAAY,OAAQpB,EAAKoB,WAAY,OAC5C,SAEF,uBAAaJ,EAAAA,EAAUK,OAA0B,IAEjD,MAAQ,SAAEC,GAAAA,EAAMC,SAAU,KAAMD,EAAKjB,MAAM,GAAI,GAAKiB,IAClDtB,EAAKoB,WAAY,KAAMpB,EAAQ,IAAGA,MCtBtC,QAAuBA,SAAQA,SAAAA,EAAMoB,WAAY,OAElB,IACE,uCAAaI,wBAAqBT,IAkBpC,CAACf,EAAMyB,KACpC,GAAqB,mBACnB,SAEF,IAAKN,EAAYnB,GACf,SAGF,MAAMC,SAAEA,EAAFM,OAAYA,EAAZH,KAAoBA,GAASsB,EAAU1B,KAC9B2B,IACf,MAAmB3B,EAOnB,MALgB,WAAZ4B,GAAmC,UAAZA,IAEzBC,EAAgB,GADDC,EAAyB7B,EAAU2B,KACvBrB,IAASH,OAGhByB,GAClBE,EAAWF,GAlCjB,SAAoB7B,EAAMgC,GAExB,GAAIC,EAAejC,GACjB,SAGF,QAAe2B,MACMO,EAAQlC,EAAMgC,GAEnC,MAAgB,WAAZJ,GAAmC,UAAZA,IACOO,EAAcP,KAyB5CQ,CAAWP,EAAcJ,uJCrCCzB,GAC9B,SAAkBA,EAAMqB,KAG1B,QAAyB,CACvBgB,gBAAiBC,EAAUC,OAC3BC,YAAaF,EAAUG,OACvBC,gBAAiBJ,EAAUK,MAqB7B,WAAmCC,gBACjC,OACEC,gBAACC,OACE,EAAGC,SAAAA,kBAAeF,gBAACG,OAAeJ,GAAOK,UAAWF,MAK3D,kBAA+BG,UAC7BC,YAAYP,GACVQ,MAAMR,GADWS,KA2EnBC,gBAAkB,EAAGC,mBAAAA,EAAoBC,UAAAA,MACnCH,KAAKT,MAAMF,gBAAkBa,EAAqBC,GAC7C,CACLC,UAAW,CAACJ,KAAKT,MAAMa,UAAWJ,KAAKT,MAAMP,iBAC1CqB,OAAOC,SACPC,KAAM,KACTC,WAAYR,KAAKT,MAAMiB,MAAUR,KAAKT,MAAMJ,mBA9EhD,OAAkB,EACK,4BAAcsB,OAAOC,uBAC1CC,GAAc,GAGhBX,KAAKY,MAAQ,CACXD,YAAAA,GAEFX,KAAKa,cAAgB,KACrBb,KAAKc,UAAYd,KAAKc,UAAUC,KAAKf,MAGvCgB,YACE,MAAkBP,OAAOf,SAAS9C,SAAW6D,OAAOf,SAASxC,OAGzD8C,KAAKT,MAAMK,WAAaI,KAAKT,MAAMK,UAAUhD,WAC/CqE,EAAcjB,KAAKT,MAAMK,UAAUhD,SAAWoD,KAAKT,MAAMK,UAAU1C,QAGrE,QACemB,EADO6C,EAAgBlB,KAAKT,MAAM4B,GAAIF,MAGjCG,EAAOxE,SAAWwE,EAAOlE,OAI7C,GAAI+D,IAAgBI,EAClB,iBAAiBC,QAAQD,GAM7BE,uBACE,IAAKvB,KAAKwB,GACR,OAEF,MAAMC,SAAEA,EAAFC,GAAYA,GAAO1B,KAAKwB,GAE1BxB,KAAKa,eACPb,KAAKa,cAAcc,QAGrBF,EAASG,UAAUF,GACnBD,EAASI,aAGXf,UAAUgB,GAEN9B,KAAKT,MAAMwC,UACXC,OAAOC,UAAUC,eAAeC,KAAKnC,KAAKT,MAAMwC,SAAW,WAE3D/B,KAAKT,MAAMwC,SAASpD,QAAUmD,EACrB9B,KAAKT,MAAMwC,UACpB/B,KAAKT,MAAMwC,SAASD,GAGlB9B,KAAKY,MAAMD,aAAemB,IAE5B9B,KAAKwB,GAzFwB,EAACE,EAAIU,KACtC,QAAW,WAAW1B,qBAAqB2B,IACzCA,EAAQC,QAAQC,IACVb,IAAOa,EAAMC,QAGfJ,EAAGG,EAAME,gBAAkBF,EAAMG,kBAAoB,OAQ3D,OAFAlB,EAAGmB,QAAQjB,GAEJ,CAAED,SAAUD,EAAIE,GAAAA,IA2ETkB,CAA2Bd,EAAKe,IACpCA,EACF7C,KAAKa,cAAgBb,KAAKgB,YAEtBhB,KAAKa,eACPb,KAAKa,cAAcc,WAmB7BmB,SACE,QAeI9C,KAAKT,OAfH4B,GACJA,EADI4B,SAEJA,EAAW/C,KAAKC,gBAFZ+C,QAGJA,EAHIC,aAIJA,EAJIrC,MAUJA,EAVIsC,QAWJA,EAXItD,UAYJA,KAEGuD,0IAGyB,eAA1B7F,QAAQC,IAAIC,UAA8BM,EAAYqD,IACxDiC,QAAQC,KACL,iBAAgBlC,8HAIrB,QAAmBD,EAAgBC,EAAIvB,EAAUhD,UACjD,OAAKkB,EAAYwF,gBAKf9D,gBAAC+D,KACCpC,GAAImC,EACJ1C,MAAOA,EACPmC,SAAUA,EACVhB,SAAU/B,KAAKc,UACfmC,aAAcO,IACRP,GACFA,EAAaO,GAEf,QAAenF,EAAUiF,GACzBG,UAAUC,SAAStC,EAAOxE,SAAWwE,EAAOlE,SAE9C8F,QAASQ,IAKP,GAJIR,GACFA,EAAQQ,KAIK,IAAbA,EAAEG,QACD3D,KAAKT,MAAMiD,QACXgB,EAAEI,kBACFJ,EAAEK,SACFL,EAAEM,QACFN,EAAEO,SACFP,EAAEQ,UACH,CACAR,EAAES,iBAEF,MAAoBf,EACpB,QAAkBgB,UAAUZ,KAAgB1D,EAAUhD,SAE9B,qBAAYuD,IAClCgE,GAAgB,GAIlB1D,OAAO2D,YAAYd,EAAY,CAC7B1C,MAAAA,EACAsC,QAASiB,IAIb,WAEEhB,iBAhDC3D,uBAAG6E,KAAMf,GAAgBH,KAsDtCxD,EAAW2E,eACNC,GACHvB,QAAS/D,EAAUuF,KACnBrD,GAAIlC,EAAUC,OAAOuF,WACrBvB,QAASjE,EAAUK,KACnBsB,MAAO3B,EAAUG,SAGnB,QAAqBsF,WAAW,CAACnF,EAAOuC,iBACtCtC,gBAACmF,KAA0B5C,SAAUD,GAASvC,KAGnCqF,QAAW,CAACzD,EAAI0D,KAC3BpE,OAAO2D,YAAYlD,EAAgBC,EAAIV,OAAOf,SAAS9C,UAAWiI"}